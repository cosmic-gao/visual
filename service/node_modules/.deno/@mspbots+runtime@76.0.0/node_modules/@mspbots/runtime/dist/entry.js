function c(_0x75d75,_0x1c4fc1){let _0x4a397c=Object['fromEntries'](Object['entries'](_0x75d75['headers']||{})['map'](([_0x2b6868,_0x461a29])=>[_0x2b6868['toLowerCase'](),_0x461a29]));return{'id':_0x75d75['app']['id']||_0x1c4fc1['appId']||'','name':_0x75d75['app']['name']||'','version':_0x75d75['app']['version']||'','description':_0x75d75['app']['description']||'','metadata':{..._0x75d75['metadata'],'permissions':_0x75d75['permissions']},'body':_0x75d75['body'],'query':_0x75d75['query'],'params':_0x75d75?.['params'],'method':_0x75d75['method'],'pathname':_0x75d75['pathname'],'requestUrl':_0x75d75['requestUrl'],'user':_0x75d75['user'],'headers':_0x4a397c};}function f(_0x2716c1){return _0x2716c1['split']('/')['filter'](_0x49a634=>_0x49a634['length']>0x0);}function P(_0x548a6f,_0x20d947){let _0x3a1da2=f(_0x548a6f),_0x309293=f(_0x20d947),_0x21e684=0x0,_0x585b71=0x0;for(;_0x21e684<_0x3a1da2['length']&&_0x585b71<_0x309293['length'];){let _0xbc56b5=_0x3a1da2[_0x21e684],_0x53b688=_0x309293[_0x585b71];if(_0xbc56b5==='*')return!![];if(_0xbc56b5['startsWith'](':')){_0x21e684++,_0x585b71++;continue;}if(_0xbc56b5!==_0x53b688)return![];_0x21e684++,_0x585b71++;}return _0x21e684===_0x3a1da2['length']&&_0x585b71===_0x309293['length']||_0x21e684===_0x3a1da2['length']-0x1&&_0x3a1da2[_0x21e684]==='*';}function m(_0x3c12cb,_0x40aac4,_0x75e364){let _0x5dc5da=_0x40aac4+'\x20'+_0x75e364;if(_0x3c12cb[_0x5dc5da])return{'handler':_0x3c12cb[_0x5dc5da],'routePattern':_0x75e364};let _0x166f26=[];_0x75e364['startsWith']('/api')?_0x166f26['push'](_0x75e364['substring'](0x4)||'/'):_0x166f26['push']('/api'+_0x75e364),_0x166f26['push'](_0x75e364);for(let _0x765c64 of _0x166f26)for(let _0x4c8455 of Object['keys'](_0x3c12cb)){if(!_0x4c8455['startsWith'](_0x40aac4+'\x20'))continue;let _0x56d9b7=_0x4c8455['substring'](_0x40aac4['length']+0x1);if(P(_0x56d9b7,_0x765c64))return{'handler':_0x3c12cb[_0x4c8455],'routePattern':_0x56d9b7};}return null;}function k(_0x11fcff){return typeof _0x11fcff=='function'?{'handler':_0x11fcff,'routePattern':''}:_0x11fcff;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x115fce){let _0x3b4c27=async _0x2f5453=>{try{let _0x414de3=globalThis['Deno'];if(!_0x414de3)throw new Error('Deno is not available');return await _0x414de3['stat'](_0x2f5453),!0x0;}catch{return![];}};if(_0x115fce&&typeof _0x115fce=='string'&&_0x115fce['length']>0x0)return _0x115fce;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0xfb63a2=s['manifest']?.['metadata']?.['serverPath'];if(_0xfb63a2&&typeof _0xfb63a2=='string'&&_0xfb63a2['length']>0x0)return _0xfb63a2;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x53b09d=s['manifest']['name'];if(!_0x53b09d)throw new Error('Manifest\x20name\x20not\x20found');let _0x202ab5=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x53b09d+'/server.js',s['appsDir']+'/'+_0x53b09d+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0xd347a3 of _0x202ab5)if(await _0x3b4c27(_0xd347a3))return _0xd347a3;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x202ab5['join'](',\x20'));}function R(){let _0x3b7a16=['log','info','warn','error','debug','trace'];for(let _0x5cdae1 of _0x3b7a16){let _0x4bf91a=(console[_0x5cdae1]||console['log'])['bind'](console);console[_0x5cdae1]=(..._0x38c16c)=>{try{let _0x53979a=_0x38c16c['map'](_0x510127=>{if(typeof _0x510127=='string')return _0x510127;if(_0x510127 instanceof Error)return JSON['stringify']({'name':_0x510127['name'],'message':_0x510127['message'],'stack':_0x510127['stack']});if(typeof Request<'u'&&_0x510127 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x510127['url'],'method':_0x510127['method'],'headers':Object['fromEntries'](_0x510127['headers']['entries']()),'bodyUsed':_0x510127['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x510127 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x510127['status'],'headers':Object['fromEntries'](_0x510127['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x510127);}catch{return String(_0x510127);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x5cdae1==='log'?'info':_0x5cdae1,'message':_0x53979a,'meta':{'appId':s['appId']}});}catch{_0x4bf91a(..._0x38c16c);}};}}R();async function v(_0x25278){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x4948ef=(await w(_0x25278))['replace'](/\\/g,'/'),_0x298093=(_0x4948ef['startsWith']('file://')?_0x4948ef:'file://'+_0x4948ef)+'?t='+Date['now']();try{let _0x360671=await import(_0x298093);return s['module']=_0x360671,_0x360671;}catch(_0xfc9777){throw console['error']('Failed to load module:',_0xfc9777),_0xfc9777;}}function b(_0x48e245){return _0x48e245 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x48e245,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x1657e3){return _0x1657e3['split']('/')['filter'](_0x15b4ab=>_0x15b4ab['length']>0x0);}function E(_0x208813){try{return decodeURIComponent(_0x208813);}catch{return _0x208813;}}function I(_0xb907f5,_0x4de93e){let _0x74c8aa=g(_0xb907f5),_0x303f56=g(_0x4de93e),_0x3ab8a4={},_0x3dac0c=0x0,_0x237e09=0x0;for(;_0x3dac0c<_0x74c8aa['length']&&_0x237e09<_0x303f56['length'];){let _0x4afd6c=_0x74c8aa[_0x3dac0c],_0x1230e0=_0x303f56[_0x237e09];if(_0x4afd6c==='*')break;if(_0x4afd6c['startsWith'](':')){let _0xbefe23=_0x4afd6c['slice'](0x1);_0xbefe23&&(_0x3ab8a4[_0xbefe23]=E(_0x1230e0)),_0x3dac0c++,_0x237e09++;continue;}if(_0x4afd6c!==_0x1230e0)return{};_0x3dac0c++,_0x237e09++;}return _0x3dac0c===_0x74c8aa['length']||_0x3dac0c===_0x74c8aa['length']-0x1&&_0x74c8aa[_0x3dac0c]==='*',_0x3ab8a4;}function M(_0x6d6460,_0x5c6ade){return _0x6d6460['startsWith']('/api')&&!_0x5c6ade['startsWith']('/api')?_0x6d6460['substring'](0x4)||'/':!_0x6d6460['startsWith']('/api')&&_0x5c6ade['startsWith']('/api')?'/api'+(_0x6d6460['startsWith']('/')?'':'/')+_0x6d6460:_0x6d6460;}async function W(_0x401b0f){let _0x1a06d1=_0x401b0f['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x1a06d1)&&await v(_0x1a06d1);let _0x2ffbb8=_0x401b0f['ctx'],{method:_0x3fbd23,pathname:_0x4a2ef1}=_0x2ffbb8,_0x2b4a53=s['module']?.['default']||{},_0x48befa=m(_0x2b4a53,_0x3fbd23,_0x4a2ef1);if(!_0x48befa)throw Object['assign'](new Error('Route\x20'+_0x3fbd23+'\x20'+_0x4a2ef1+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x4b30c1=k(_0x48befa),_0x548bff=c(_0x2ffbb8,s),_0x3a1595=_0x4a2ef1,_0x4aa498=M(_0x4b30c1['routePattern'],_0x3a1595),_0x4f5f81=_0x4aa498?I(_0x4aa498,_0x3a1595):{},_0x597329=await _0x4b30c1['handler']({..._0x548bff,'params':{..._0x548bff['params'],..._0x4f5f81}});return b(_0x597329);}function D(_0x3869e0){s['appId']=_0x3869e0['appId'],s['manifest']=_0x3869e0['manifest'],s['appsDir']=_0x3869e0['appsDir'],s['serverPath']=_0x3869e0['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x3e4997){let {reqId:_0x1a8e75,payload:_0x553ef5}=_0x3e4997;try{let _0xbda093=await W(_0x553ef5);self['postMessage']({'type':'result','reqId':_0x1a8e75,'ok':!0x0,'response':_0xbda093});}catch(_0x4a72fa){let _0x1e7fc3=_0x4a72fa;self['postMessage']({'type':'result','reqId':_0x1a8e75,'ok':![],'error':{'message':_0x1e7fc3['message'],'stack':_0x1e7fc3['stack'],'code':_0x1e7fc3['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x445f0c=>{let _0x17ed37=_0x445f0c['data'];try{switch(_0x17ed37['type']){case'init':D(_0x17ed37);break;case'invoke':await $(_0x17ed37);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x17ed37['type']);break;}}catch(_0xe86719){let _0x25895c=_0xe86719;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x25895c['message'],'stack':_0x25895c['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x25895c);}}},self['onerror']=_0x302b4b=>{let _0x2a980f={'message':typeof _0x302b4b=='string'?_0x302b4b:_0x302b4b['message'],'filename':typeof _0x302b4b=='string'?void 0x0:_0x302b4b['filename'],'lineno':typeof _0x302b4b=='string'?void 0x0:_0x302b4b['lineno'],'colno':typeof _0x302b4b=='string'?void 0x0:_0x302b4b['colno'],'error':typeof _0x302b4b=='string'?void 0x0:_0x302b4b['error']?.['message'],'stack':typeof _0x302b4b=='string'?void 0x0:_0x302b4b['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x2a980f);},self['onunhandledrejection']=_0x3e1356=>{let _0x5bb55e=_0x3e1356['reason'],_0x5b225d={'appId':s['appId'],'reason':_0x5bb55e instanceof Error?_0x5bb55e['message']:String(_0x5bb55e),'stack':_0x5bb55e instanceof Error?_0x5bb55e['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x5b225d);};