function c(_0x46d3be,_0x55765e){let _0xbd00fd=Object['fromEntries'](Object['entries'](_0x46d3be['headers']||{})['map'](([_0x1b96f5,_0x46770e])=>[_0x1b96f5['toLowerCase'](),_0x46770e]));return{'id':_0x46d3be['app']['id']||_0x55765e['appId']||'','name':_0x46d3be['app']['name']||'','version':_0x46d3be['app']['version']||'','description':_0x46d3be['app']['description']||'','metadata':{..._0x46d3be['metadata'],'permissions':_0x46d3be['permissions']},'body':_0x46d3be['body'],'query':_0x46d3be['query'],'params':_0x46d3be?.['params'],'method':_0x46d3be['method'],'pathname':_0x46d3be['pathname'],'requestUrl':_0x46d3be['requestUrl'],'user':_0x46d3be['user'],'headers':_0xbd00fd};}function f(_0x1eed54){return _0x1eed54['split']('/')['filter'](_0x2917d1=>_0x2917d1['length']>0x0);}function P(_0x2c8b02,_0x133bda){let _0x5f0fd1=f(_0x2c8b02),_0x90c9a1=f(_0x133bda),_0x14349a=0x0,_0x52a526=0x0;for(;_0x14349a<_0x5f0fd1['length']&&_0x52a526<_0x90c9a1['length'];){let _0x11995f=_0x5f0fd1[_0x14349a],_0xedd533=_0x90c9a1[_0x52a526];if(_0x11995f==='*')return!![];if(_0x11995f['startsWith'](':')){_0x14349a++,_0x52a526++;continue;}if(_0x11995f!==_0xedd533)return![];_0x14349a++,_0x52a526++;}return _0x14349a===_0x5f0fd1['length']&&_0x52a526===_0x90c9a1['length']||_0x14349a===_0x5f0fd1['length']-0x1&&_0x5f0fd1[_0x14349a]==='*';}function m(_0x5a1e6c,_0xbef93,_0x5a9f71){let _0x165860=_0xbef93+'\x20'+_0x5a9f71;if(_0x5a1e6c[_0x165860])return{'handler':_0x5a1e6c[_0x165860],'routePattern':_0x5a9f71};let _0xf83357=[];_0x5a9f71['startsWith']('/api')?_0xf83357['push'](_0x5a9f71['substring'](0x4)||'/'):_0xf83357['push']('/api'+_0x5a9f71),_0xf83357['push'](_0x5a9f71);for(let _0x476c55 of _0xf83357)for(let _0x1de9a4 of Object['keys'](_0x5a1e6c)){if(!_0x1de9a4['startsWith'](_0xbef93+'\x20'))continue;let _0x55d7c1=_0x1de9a4['substring'](_0xbef93['length']+0x1);if(P(_0x55d7c1,_0x476c55))return{'handler':_0x5a1e6c[_0x1de9a4],'routePattern':_0x55d7c1};}return null;}function k(_0x1e5121){return typeof _0x1e5121=='function'?{'handler':_0x1e5121,'routePattern':''}:_0x1e5121;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x3e06e5){let _0x1c3adb=async _0x5d6649=>{try{let _0x424c0a=globalThis['Deno'];if(!_0x424c0a)throw new Error('Deno is not available');return await _0x424c0a['stat'](_0x5d6649),!0x0;}catch{return![];}};if(_0x3e06e5&&typeof _0x3e06e5=='string'&&_0x3e06e5['length']>0x0)return _0x3e06e5;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x1cfd7c=s['manifest']?.['metadata']?.['serverPath'];if(_0x1cfd7c&&typeof _0x1cfd7c=='string'&&_0x1cfd7c['length']>0x0)return _0x1cfd7c;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x1c50e0=s['manifest']['name'];if(!_0x1c50e0)throw new Error('Manifest\x20name\x20not\x20found');let _0x2bd311=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x1c50e0+'/server.js',s['appsDir']+'/'+_0x1c50e0+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x5cd909 of _0x2bd311)if(await _0x1c3adb(_0x5cd909))return _0x5cd909;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x2bd311['join'](',\x20'));}function R(){let _0xb968a4=['log','info','warn','error','debug','trace'];for(let _0x5792a6 of _0xb968a4){let _0x1d0141=(console[_0x5792a6]||console['log'])['bind'](console);console[_0x5792a6]=(..._0x9a268e)=>{try{let _0x38b1d6=_0x9a268e['map'](_0x1190fa=>{if(typeof _0x1190fa=='string')return _0x1190fa;if(_0x1190fa instanceof Error)return JSON['stringify']({'name':_0x1190fa['name'],'message':_0x1190fa['message'],'stack':_0x1190fa['stack']});if(typeof Request<'u'&&_0x1190fa instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x1190fa['url'],'method':_0x1190fa['method'],'headers':Object['fromEntries'](_0x1190fa['headers']['entries']()),'bodyUsed':_0x1190fa['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x1190fa instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x1190fa['status'],'headers':Object['fromEntries'](_0x1190fa['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x1190fa);}catch{return String(_0x1190fa);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x5792a6==='log'?'info':_0x5792a6,'message':_0x38b1d6,'meta':{'appId':s['appId']}});}catch{_0x1d0141(..._0x9a268e);}};}}R();async function v(_0x12a9b8){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x5ad1a7=(await w(_0x12a9b8))['replace'](/\\/g,'/'),_0x242512=(_0x5ad1a7['startsWith']('file://')?_0x5ad1a7:'file://'+_0x5ad1a7)+'?t='+Date['now']();try{let _0x34105d=await import(_0x242512);return s['module']=_0x34105d,_0x34105d;}catch(_0x3682ff){throw console['error']('Failed to load module:',_0x3682ff),_0x3682ff;}}function b(_0x292d8b){return _0x292d8b instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x292d8b,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x1f5844){return _0x1f5844['split']('/')['filter'](_0x1193ea=>_0x1193ea['length']>0x0);}function E(_0x232fde){try{return decodeURIComponent(_0x232fde);}catch{return _0x232fde;}}function I(_0x4d93d4,_0x297ed4){let _0x47140d=g(_0x4d93d4),_0x26dcf9=g(_0x297ed4),_0x32f41b={},_0xd53054=0x0,_0x13220c=0x0;for(;_0xd53054<_0x47140d['length']&&_0x13220c<_0x26dcf9['length'];){let _0x3fe236=_0x47140d[_0xd53054],_0x37112a=_0x26dcf9[_0x13220c];if(_0x3fe236==='*')break;if(_0x3fe236['startsWith'](':')){let _0x1e1d58=_0x3fe236['slice'](0x1);_0x1e1d58&&(_0x32f41b[_0x1e1d58]=E(_0x37112a)),_0xd53054++,_0x13220c++;continue;}if(_0x3fe236!==_0x37112a)return{};_0xd53054++,_0x13220c++;}return _0xd53054===_0x47140d['length']||_0xd53054===_0x47140d['length']-0x1&&_0x47140d[_0xd53054]==='*',_0x32f41b;}function M(_0x43d18e,_0x1ddc0b){return _0x43d18e['startsWith']('/api')&&!_0x1ddc0b['startsWith']('/api')?_0x43d18e['substring'](0x4)||'/':!_0x43d18e['startsWith']('/api')&&_0x1ddc0b['startsWith']('/api')?'/api'+(_0x43d18e['startsWith']('/')?'':'/')+_0x43d18e:_0x43d18e;}async function W(_0x24e033){let _0x58d3dc=_0x24e033['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x58d3dc)&&await v(_0x58d3dc);let _0x4b73fe=_0x24e033['ctx'],{method:_0x226f71,pathname:_0xd3ed53}=_0x4b73fe,_0x1050cb=s['module']?.['default']||{},_0x4b727c=m(_0x1050cb,_0x226f71,_0xd3ed53);if(!_0x4b727c)throw Object['assign'](new Error('Route\x20'+_0x226f71+'\x20'+_0xd3ed53+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x4d9a16=k(_0x4b727c),_0x400175=c(_0x4b73fe,s),_0x14d1f5=_0xd3ed53,_0x4fb9f6=M(_0x4d9a16['routePattern'],_0x14d1f5),_0x1f4a5c=_0x4fb9f6?I(_0x4fb9f6,_0x14d1f5):{},_0x23b8ec=await _0x4d9a16['handler']({..._0x400175,'params':{..._0x400175['params'],..._0x1f4a5c}});return b(_0x23b8ec);}function D(_0x571ff4){s['appId']=_0x571ff4['appId'],s['manifest']=_0x571ff4['manifest'],s['appsDir']=_0x571ff4['appsDir'],s['serverPath']=_0x571ff4['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x8a4a9c){let {reqId:_0x4e8b1c,payload:_0x2e00ad}=_0x8a4a9c;try{let _0x1ec259=await W(_0x2e00ad);self['postMessage']({'type':'result','reqId':_0x4e8b1c,'ok':!0x0,'response':_0x1ec259});}catch(_0x12d76b){let _0x15b1ea=_0x12d76b;self['postMessage']({'type':'result','reqId':_0x4e8b1c,'ok':![],'error':{'message':_0x15b1ea['message'],'stack':_0x15b1ea['stack'],'code':_0x15b1ea['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x49c23a=>{let _0x2c23dd=_0x49c23a['data'];try{switch(_0x2c23dd['type']){case'init':D(_0x2c23dd);break;case'invoke':await $(_0x2c23dd);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x2c23dd['type']);break;}}catch(_0x37bbb1){let _0x2f755e=_0x37bbb1;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x2f755e['message'],'stack':_0x2f755e['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x2f755e);}}},self['onerror']=_0x30bc7c=>{let _0x4520c4={'message':typeof _0x30bc7c=='string'?_0x30bc7c:_0x30bc7c['message'],'filename':typeof _0x30bc7c=='string'?void 0x0:_0x30bc7c['filename'],'lineno':typeof _0x30bc7c=='string'?void 0x0:_0x30bc7c['lineno'],'colno':typeof _0x30bc7c=='string'?void 0x0:_0x30bc7c['colno'],'error':typeof _0x30bc7c=='string'?void 0x0:_0x30bc7c['error']?.['message'],'stack':typeof _0x30bc7c=='string'?void 0x0:_0x30bc7c['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x4520c4);},self['onunhandledrejection']=_0x12a466=>{let _0x1a3b8c=_0x12a466['reason'],_0x45f394={'appId':s['appId'],'reason':_0x1a3b8c instanceof Error?_0x1a3b8c['message']:String(_0x1a3b8c),'stack':_0x1a3b8c instanceof Error?_0x1a3b8c['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x45f394);};