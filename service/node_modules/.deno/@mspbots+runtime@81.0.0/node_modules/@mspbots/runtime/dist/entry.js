function c(_0xf56a8a,_0x5c19d0){let _0x5c3d47=Object['fromEntries'](Object['entries'](_0xf56a8a['headers']||{})['map'](([_0x1468a1,_0x562dbe])=>[_0x1468a1['toLowerCase'](),_0x562dbe]));return{'id':_0xf56a8a['app']['id']||_0x5c19d0['appId']||'','name':_0xf56a8a['app']['name']||'','version':_0xf56a8a['app']['version']||'','description':_0xf56a8a['app']['description']||'','metadata':{..._0xf56a8a['metadata'],'permissions':_0xf56a8a['permissions']},'body':_0xf56a8a['body'],'query':_0xf56a8a['query'],'params':_0xf56a8a?.['params'],'method':_0xf56a8a['method'],'pathname':_0xf56a8a['pathname'],'requestUrl':_0xf56a8a['requestUrl'],'user':_0xf56a8a['user'],'headers':_0x5c3d47};}function f(_0x27cc91){return _0x27cc91['split']('/')['filter'](_0x3979fc=>_0x3979fc['length']>0x0);}function P(_0x4d07f6,_0x187562){let _0x4cf3e6=f(_0x4d07f6),_0x263947=f(_0x187562),_0x523150=0x0,_0x3f0b40=0x0;for(;_0x523150<_0x4cf3e6['length']&&_0x3f0b40<_0x263947['length'];){let _0xcc6261=_0x4cf3e6[_0x523150],_0x37c778=_0x263947[_0x3f0b40];if(_0xcc6261==='*')return!![];if(_0xcc6261['startsWith'](':')){_0x523150++,_0x3f0b40++;continue;}if(_0xcc6261!==_0x37c778)return![];_0x523150++,_0x3f0b40++;}return _0x523150===_0x4cf3e6['length']&&_0x3f0b40===_0x263947['length']||_0x523150===_0x4cf3e6['length']-0x1&&_0x4cf3e6[_0x523150]==='*';}function m(_0x48e0c5,_0x3fd498,_0x38cfb6){let _0x4f1a4d=_0x3fd498+'\x20'+_0x38cfb6;if(_0x48e0c5[_0x4f1a4d])return{'handler':_0x48e0c5[_0x4f1a4d],'routePattern':_0x38cfb6};let _0x1bd899=[];_0x38cfb6['startsWith']('/api')?_0x1bd899['push'](_0x38cfb6['substring'](0x4)||'/'):_0x1bd899['push']('/api'+_0x38cfb6),_0x1bd899['push'](_0x38cfb6);for(let _0x474f9a of _0x1bd899)for(let _0x2ec968 of Object['keys'](_0x48e0c5)){if(!_0x2ec968['startsWith'](_0x3fd498+'\x20'))continue;let _0xa5552e=_0x2ec968['substring'](_0x3fd498['length']+0x1);if(P(_0xa5552e,_0x474f9a))return{'handler':_0x48e0c5[_0x2ec968],'routePattern':_0xa5552e};}return null;}function k(_0x4f3268){return typeof _0x4f3268=='function'?{'handler':_0x4f3268,'routePattern':''}:_0x4f3268;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x3dfa67){let _0xb8079f=async _0x5420f9=>{try{let _0x54e0c1=globalThis['Deno'];if(!_0x54e0c1)throw new Error('Deno is not available');return await _0x54e0c1['stat'](_0x5420f9),!0x0;}catch{return![];}};if(_0x3dfa67&&typeof _0x3dfa67=='string'&&_0x3dfa67['length']>0x0)return _0x3dfa67;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x2049f9=s['manifest']?.['metadata']?.['serverPath'];if(_0x2049f9&&typeof _0x2049f9=='string'&&_0x2049f9['length']>0x0)return _0x2049f9;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x50274a=s['manifest']['name'];if(!_0x50274a)throw new Error('Manifest\x20name\x20not\x20found');let _0x4aa5fb=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x50274a+'/server.js',s['appsDir']+'/'+_0x50274a+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x15c17c of _0x4aa5fb)if(await _0xb8079f(_0x15c17c))return _0x15c17c;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x4aa5fb['join'](',\x20'));}function R(){let _0x2f6495=['log','info','warn','error','debug','trace'];for(let _0x342a19 of _0x2f6495){let _0x629b8d=(console[_0x342a19]||console['log'])['bind'](console);console[_0x342a19]=(..._0x4c313b)=>{try{let _0x6b82ad=_0x4c313b['map'](_0x27ae26=>{if(typeof _0x27ae26=='string')return _0x27ae26;if(_0x27ae26 instanceof Error)return JSON['stringify']({'name':_0x27ae26['name'],'message':_0x27ae26['message'],'stack':_0x27ae26['stack']});if(typeof Request<'u'&&_0x27ae26 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x27ae26['url'],'method':_0x27ae26['method'],'headers':Object['fromEntries'](_0x27ae26['headers']['entries']()),'bodyUsed':_0x27ae26['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x27ae26 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x27ae26['status'],'headers':Object['fromEntries'](_0x27ae26['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x27ae26);}catch{return String(_0x27ae26);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x342a19==='log'?'info':_0x342a19,'message':_0x6b82ad,'meta':{'appId':s['appId']}});}catch{_0x629b8d(..._0x4c313b);}};}}R();async function v(_0x430a85){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x4d0148=(await w(_0x430a85))['replace'](/\\/g,'/'),_0x5495e2=(_0x4d0148['startsWith']('file://')?_0x4d0148:'file://'+_0x4d0148)+'?t='+Date['now']();try{let _0x3cae0e=await import(_0x5495e2);return s['module']=_0x3cae0e,_0x3cae0e;}catch(_0x1b853d){throw console['error']('Failed to load module:',_0x1b853d),_0x1b853d;}}function b(_0x175ddb){return _0x175ddb instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x175ddb,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x488a7d){return _0x488a7d['split']('/')['filter'](_0x2742be=>_0x2742be['length']>0x0);}function E(_0x325d2b){try{return decodeURIComponent(_0x325d2b);}catch{return _0x325d2b;}}function I(_0x58fbaf,_0x19245b){let _0x5ee698=g(_0x58fbaf),_0x8307be=g(_0x19245b),_0x352625={},_0x32883b=0x0,_0x570e9d=0x0;for(;_0x32883b<_0x5ee698['length']&&_0x570e9d<_0x8307be['length'];){let _0x38109d=_0x5ee698[_0x32883b],_0x2de74f=_0x8307be[_0x570e9d];if(_0x38109d==='*')break;if(_0x38109d['startsWith'](':')){let _0x3593ea=_0x38109d['slice'](0x1);_0x3593ea&&(_0x352625[_0x3593ea]=E(_0x2de74f)),_0x32883b++,_0x570e9d++;continue;}if(_0x38109d!==_0x2de74f)return{};_0x32883b++,_0x570e9d++;}return _0x32883b===_0x5ee698['length']||_0x32883b===_0x5ee698['length']-0x1&&_0x5ee698[_0x32883b]==='*',_0x352625;}function M(_0x4f2d86,_0x4146a2){return _0x4f2d86['startsWith']('/api')&&!_0x4146a2['startsWith']('/api')?_0x4f2d86['substring'](0x4)||'/':!_0x4f2d86['startsWith']('/api')&&_0x4146a2['startsWith']('/api')?'/api'+(_0x4f2d86['startsWith']('/')?'':'/')+_0x4f2d86:_0x4f2d86;}async function W(_0x373c18){let _0x36780d=_0x373c18['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x36780d)&&await v(_0x36780d);let _0x88016c=_0x373c18['ctx'],{method:_0x36d52f,pathname:_0x8573b9}=_0x88016c,_0x3e1125=s['module']?.['default']||{},_0xbdf47d=m(_0x3e1125,_0x36d52f,_0x8573b9);if(!_0xbdf47d)throw Object['assign'](new Error('Route\x20'+_0x36d52f+'\x20'+_0x8573b9+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x2a7618=k(_0xbdf47d),_0xe5f3b8=c(_0x88016c,s),_0x483fbe=_0x8573b9,_0x2b1779=M(_0x2a7618['routePattern'],_0x483fbe),_0x43df5d=_0x2b1779?I(_0x2b1779,_0x483fbe):{},_0x39b859=await _0x2a7618['handler']({..._0xe5f3b8,'params':{..._0xe5f3b8['params'],..._0x43df5d}});return b(_0x39b859);}function D(_0x51b3cc){s['appId']=_0x51b3cc['appId'],s['manifest']=_0x51b3cc['manifest'],s['appsDir']=_0x51b3cc['appsDir'],s['serverPath']=_0x51b3cc['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x195e76){let {reqId:_0x3c22bd,payload:_0x583260}=_0x195e76;try{let _0x330061=await W(_0x583260);self['postMessage']({'type':'result','reqId':_0x3c22bd,'ok':!0x0,'response':_0x330061});}catch(_0x378da4){let _0x14bb93=_0x378da4;self['postMessage']({'type':'result','reqId':_0x3c22bd,'ok':![],'error':{'message':_0x14bb93['message'],'stack':_0x14bb93['stack'],'code':_0x14bb93['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x269908=>{let _0x48c003=_0x269908['data'];try{switch(_0x48c003['type']){case'init':D(_0x48c003);break;case'invoke':await $(_0x48c003);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x48c003['type']);break;}}catch(_0x114cf8){let _0x149260=_0x114cf8;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x149260['message'],'stack':_0x149260['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x149260);}}},self['onerror']=_0x1601c4=>{let _0x58e274={'message':typeof _0x1601c4=='string'?_0x1601c4:_0x1601c4['message'],'filename':typeof _0x1601c4=='string'?void 0x0:_0x1601c4['filename'],'lineno':typeof _0x1601c4=='string'?void 0x0:_0x1601c4['lineno'],'colno':typeof _0x1601c4=='string'?void 0x0:_0x1601c4['colno'],'error':typeof _0x1601c4=='string'?void 0x0:_0x1601c4['error']?.['message'],'stack':typeof _0x1601c4=='string'?void 0x0:_0x1601c4['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x58e274);},self['onunhandledrejection']=_0x285919=>{let _0x4d1564=_0x285919['reason'],_0x36fe1b={'appId':s['appId'],'reason':_0x4d1564 instanceof Error?_0x4d1564['message']:String(_0x4d1564),'stack':_0x4d1564 instanceof Error?_0x4d1564['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x36fe1b);};