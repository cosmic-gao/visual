function c(_0x5b956e,_0x3e45f2){let _0xfada2c=Object['fromEntries'](Object['entries'](_0x5b956e['headers']||{})['map'](([_0x1077ee,_0x5e2745])=>[_0x1077ee['toLowerCase'](),_0x5e2745]));return{'id':_0x5b956e['app']['id']||_0x3e45f2['appId']||'','name':_0x5b956e['app']['name']||'','version':_0x5b956e['app']['version']||'','description':_0x5b956e['app']['description']||'','metadata':{..._0x5b956e['metadata'],'permissions':_0x5b956e['permissions']},'body':_0x5b956e['body'],'query':_0x5b956e['query'],'params':_0x5b956e?.['params'],'method':_0x5b956e['method'],'pathname':_0x5b956e['pathname'],'requestUrl':_0x5b956e['requestUrl'],'user':_0x5b956e['user'],'headers':_0xfada2c};}function f(_0x1db369){return _0x1db369['split']('/')['filter'](_0x4a4e32=>_0x4a4e32['length']>0x0);}function P(_0x4cadd2,_0x386451){let _0x162730=f(_0x4cadd2),_0x3d89f4=f(_0x386451),_0x178e22=0x0,_0x2dcdb6=0x0;for(;_0x178e22<_0x162730['length']&&_0x2dcdb6<_0x3d89f4['length'];){let _0x3edec0=_0x162730[_0x178e22],_0x1c8da4=_0x3d89f4[_0x2dcdb6];if(_0x3edec0==='*')return!![];if(_0x3edec0['startsWith'](':')){_0x178e22++,_0x2dcdb6++;continue;}if(_0x3edec0!==_0x1c8da4)return![];_0x178e22++,_0x2dcdb6++;}return _0x178e22===_0x162730['length']&&_0x2dcdb6===_0x3d89f4['length']||_0x178e22===_0x162730['length']-0x1&&_0x162730[_0x178e22]==='*';}function m(_0x5cb3d8,_0x53d9cf,_0x3df09e){let _0x50f445=_0x53d9cf+'\x20'+_0x3df09e;if(_0x5cb3d8[_0x50f445])return{'handler':_0x5cb3d8[_0x50f445],'routePattern':_0x3df09e};let _0x15eb88=[];_0x3df09e['startsWith']('/api')?_0x15eb88['push'](_0x3df09e['substring'](0x4)||'/'):_0x15eb88['push']('/api'+_0x3df09e),_0x15eb88['push'](_0x3df09e);for(let _0x58953d of _0x15eb88)for(let _0x55cdbe of Object['keys'](_0x5cb3d8)){if(!_0x55cdbe['startsWith'](_0x53d9cf+'\x20'))continue;let _0x26829d=_0x55cdbe['substring'](_0x53d9cf['length']+0x1);if(P(_0x26829d,_0x58953d))return{'handler':_0x5cb3d8[_0x55cdbe],'routePattern':_0x26829d};}return null;}function k(_0x1da428){return typeof _0x1da428=='function'?{'handler':_0x1da428,'routePattern':''}:_0x1da428;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x12a66d){let _0x3cf4b7=async _0x319b24=>{try{let _0x3505be=globalThis['Deno'];if(!_0x3505be)throw new Error('Deno is not available');return await _0x3505be['stat'](_0x319b24),!0x0;}catch{return![];}};if(_0x12a66d&&typeof _0x12a66d=='string'&&_0x12a66d['length']>0x0)return _0x12a66d;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x217c4f=s['manifest']?.['metadata']?.['serverPath'];if(_0x217c4f&&typeof _0x217c4f=='string'&&_0x217c4f['length']>0x0)return _0x217c4f;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x2efa6c=s['manifest']['name'];if(!_0x2efa6c)throw new Error('Manifest\x20name\x20not\x20found');let _0x2f0ebc=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x2efa6c+'/server.js',s['appsDir']+'/'+_0x2efa6c+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x2c9995 of _0x2f0ebc)if(await _0x3cf4b7(_0x2c9995))return _0x2c9995;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x2f0ebc['join'](',\x20'));}function R(){let _0x3036a1=['log','info','warn','error','debug','trace'];for(let _0x3eb79c of _0x3036a1){let _0x54c76a=(console[_0x3eb79c]||console['log'])['bind'](console);console[_0x3eb79c]=(..._0x550670)=>{try{let _0x56f723=_0x550670['map'](_0x1cf3d4=>{if(typeof _0x1cf3d4=='string')return _0x1cf3d4;if(_0x1cf3d4 instanceof Error)return JSON['stringify']({'name':_0x1cf3d4['name'],'message':_0x1cf3d4['message'],'stack':_0x1cf3d4['stack']});if(typeof Request<'u'&&_0x1cf3d4 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x1cf3d4['url'],'method':_0x1cf3d4['method'],'headers':Object['fromEntries'](_0x1cf3d4['headers']['entries']()),'bodyUsed':_0x1cf3d4['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x1cf3d4 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x1cf3d4['status'],'headers':Object['fromEntries'](_0x1cf3d4['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x1cf3d4);}catch{return String(_0x1cf3d4);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x3eb79c==='log'?'info':_0x3eb79c,'message':_0x56f723,'meta':{'appId':s['appId']}});}catch{_0x54c76a(..._0x550670);}};}}R();async function v(_0x5ad5fe){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x339f9b=(await w(_0x5ad5fe))['replace'](/\\/g,'/'),_0x4d81f7=(_0x339f9b['startsWith']('file://')?_0x339f9b:'file://'+_0x339f9b)+'?t='+Date['now']();try{let _0x579217=await import(_0x4d81f7);return s['module']=_0x579217,_0x579217;}catch(_0x571fe7){throw console['error']('Failed to load module:',_0x571fe7),_0x571fe7;}}function b(_0x1da141){return _0x1da141 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x1da141,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0xde2c7b){return _0xde2c7b['split']('/')['filter'](_0x570a95=>_0x570a95['length']>0x0);}function E(_0x883a48){try{return decodeURIComponent(_0x883a48);}catch{return _0x883a48;}}function I(_0x3787d3,_0x1ff68f){let _0x41ae7e=g(_0x3787d3),_0x9f4594=g(_0x1ff68f),_0x477ec4={},_0x47dce4=0x0,_0x3cfc8d=0x0;for(;_0x47dce4<_0x41ae7e['length']&&_0x3cfc8d<_0x9f4594['length'];){let _0x3200c3=_0x41ae7e[_0x47dce4],_0x973f5c=_0x9f4594[_0x3cfc8d];if(_0x3200c3==='*')break;if(_0x3200c3['startsWith'](':')){let _0xc21390=_0x3200c3['slice'](0x1);_0xc21390&&(_0x477ec4[_0xc21390]=E(_0x973f5c)),_0x47dce4++,_0x3cfc8d++;continue;}if(_0x3200c3!==_0x973f5c)return{};_0x47dce4++,_0x3cfc8d++;}return _0x47dce4===_0x41ae7e['length']||_0x47dce4===_0x41ae7e['length']-0x1&&_0x41ae7e[_0x47dce4]==='*',_0x477ec4;}function M(_0x49981d,_0xd5eecb){return _0x49981d['startsWith']('/api')&&!_0xd5eecb['startsWith']('/api')?_0x49981d['substring'](0x4)||'/':!_0x49981d['startsWith']('/api')&&_0xd5eecb['startsWith']('/api')?'/api'+(_0x49981d['startsWith']('/')?'':'/')+_0x49981d:_0x49981d;}async function W(_0x36436d){let _0x40f6df=_0x36436d['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x40f6df)&&await v(_0x40f6df);let _0x4040fe=_0x36436d['ctx'],{method:_0x7a5911,pathname:_0x458688}=_0x4040fe,_0x3435fe=s['module']?.['default']||{},_0x5999b2=m(_0x3435fe,_0x7a5911,_0x458688);if(!_0x5999b2)throw Object['assign'](new Error('Route\x20'+_0x7a5911+'\x20'+_0x458688+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x389dc0=k(_0x5999b2),_0x16cd11=c(_0x4040fe,s),_0x5378f0=_0x458688,_0x2754c5=M(_0x389dc0['routePattern'],_0x5378f0),_0x32da36=_0x2754c5?I(_0x2754c5,_0x5378f0):{},_0x3fc688=await _0x389dc0['handler']({..._0x16cd11,'params':{..._0x16cd11['params'],..._0x32da36}});return b(_0x3fc688);}function D(_0x57c68d){s['appId']=_0x57c68d['appId'],s['manifest']=_0x57c68d['manifest'],s['appsDir']=_0x57c68d['appsDir'],s['serverPath']=_0x57c68d['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x530beb){let {reqId:_0x48c29c,payload:_0x50fc09}=_0x530beb;try{let _0x420c0c=await W(_0x50fc09);self['postMessage']({'type':'result','reqId':_0x48c29c,'ok':!0x0,'response':_0x420c0c});}catch(_0x1ee202){let _0x116c71=_0x1ee202;self['postMessage']({'type':'result','reqId':_0x48c29c,'ok':![],'error':{'message':_0x116c71['message'],'stack':_0x116c71['stack'],'code':_0x116c71['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x4cb474=>{let _0x349262=_0x4cb474['data'];try{switch(_0x349262['type']){case'init':D(_0x349262);break;case'invoke':await $(_0x349262);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x349262['type']);break;}}catch(_0x1a92cb){let _0x219b9f=_0x1a92cb;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x219b9f['message'],'stack':_0x219b9f['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x219b9f);}}},self['onerror']=_0x161016=>{let _0xb56f03={'message':typeof _0x161016=='string'?_0x161016:_0x161016['message'],'filename':typeof _0x161016=='string'?void 0x0:_0x161016['filename'],'lineno':typeof _0x161016=='string'?void 0x0:_0x161016['lineno'],'colno':typeof _0x161016=='string'?void 0x0:_0x161016['colno'],'error':typeof _0x161016=='string'?void 0x0:_0x161016['error']?.['message'],'stack':typeof _0x161016=='string'?void 0x0:_0x161016['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0xb56f03);},self['onunhandledrejection']=_0x599f60=>{let _0x4781ec=_0x599f60['reason'],_0x19b287={'appId':s['appId'],'reason':_0x4781ec instanceof Error?_0x4781ec['message']:String(_0x4781ec),'stack':_0x4781ec instanceof Error?_0x4781ec['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x19b287);};