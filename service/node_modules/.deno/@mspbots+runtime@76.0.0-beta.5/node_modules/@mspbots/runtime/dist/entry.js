function c(_0x4b9899,_0x56e4c5){let _0x24d073=Object['fromEntries'](Object['entries'](_0x4b9899['headers']||{})['map'](([_0x2eadea,_0x697732])=>[_0x2eadea['toLowerCase'](),_0x697732]));return{'id':_0x4b9899['app']['id']||_0x56e4c5['appId']||'','name':_0x4b9899['app']['name']||'','version':_0x4b9899['app']['version']||'','description':_0x4b9899['app']['description']||'','metadata':{..._0x4b9899['metadata'],'permissions':_0x4b9899['permissions']},'body':_0x4b9899['body'],'query':_0x4b9899['query'],'params':_0x4b9899?.['params'],'method':_0x4b9899['method'],'pathname':_0x4b9899['pathname'],'requestUrl':_0x4b9899['requestUrl'],'user':_0x4b9899['user'],'headers':_0x24d073};}function f(_0x225f6d){return _0x225f6d['split']('/')['filter'](_0x609a71=>_0x609a71['length']>0x0);}function P(_0x56a37f,_0x2b584d){let _0x30a8be=f(_0x56a37f),_0x1b96a5=f(_0x2b584d),_0x51645b=0x0,_0x5af27d=0x0;for(;_0x51645b<_0x30a8be['length']&&_0x5af27d<_0x1b96a5['length'];){let _0x40bdad=_0x30a8be[_0x51645b],_0x42fb38=_0x1b96a5[_0x5af27d];if(_0x40bdad==='*')return!![];if(_0x40bdad['startsWith'](':')){_0x51645b++,_0x5af27d++;continue;}if(_0x40bdad!==_0x42fb38)return![];_0x51645b++,_0x5af27d++;}return _0x51645b===_0x30a8be['length']&&_0x5af27d===_0x1b96a5['length']||_0x51645b===_0x30a8be['length']-0x1&&_0x30a8be[_0x51645b]==='*';}function m(_0x49f018,_0xde931a,_0x256d2e){let _0x2a5fbd=_0xde931a+'\x20'+_0x256d2e;if(_0x49f018[_0x2a5fbd])return{'handler':_0x49f018[_0x2a5fbd],'routePattern':_0x256d2e};let _0x5ca600=[];_0x256d2e['startsWith']('/api')?_0x5ca600['push'](_0x256d2e['substring'](0x4)||'/'):_0x5ca600['push']('/api'+_0x256d2e),_0x5ca600['push'](_0x256d2e);for(let _0x2e89bb of _0x5ca600)for(let _0x447953 of Object['keys'](_0x49f018)){if(!_0x447953['startsWith'](_0xde931a+'\x20'))continue;let _0x499fb4=_0x447953['substring'](_0xde931a['length']+0x1);if(P(_0x499fb4,_0x2e89bb))return{'handler':_0x49f018[_0x447953],'routePattern':_0x499fb4};}return null;}function k(_0x49f7a1){return typeof _0x49f7a1=='function'?{'handler':_0x49f7a1,'routePattern':''}:_0x49f7a1;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x38e15a){let _0x324dd0=async _0x40ed8f=>{try{let _0x34a084=globalThis['Deno'];if(!_0x34a084)throw new Error('Deno is not available');return await _0x34a084['stat'](_0x40ed8f),!0x0;}catch{return![];}};if(_0x38e15a&&typeof _0x38e15a=='string'&&_0x38e15a['length']>0x0)return _0x38e15a;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x29be6a=s['manifest']?.['metadata']?.['serverPath'];if(_0x29be6a&&typeof _0x29be6a=='string'&&_0x29be6a['length']>0x0)return _0x29be6a;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x291250=s['manifest']['name'];if(!_0x291250)throw new Error('Manifest\x20name\x20not\x20found');let _0x36c465=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x291250+'/server.js',s['appsDir']+'/'+_0x291250+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x5aa82c of _0x36c465)if(await _0x324dd0(_0x5aa82c))return _0x5aa82c;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x36c465['join'](',\x20'));}function R(){let _0x446a92=['log','info','warn','error','debug','trace'];for(let _0x46ad18 of _0x446a92){let _0x934ea8=(console[_0x46ad18]||console['log'])['bind'](console);console[_0x46ad18]=(..._0x440246)=>{try{let _0x73f860=_0x440246['map'](_0x2d4239=>{if(typeof _0x2d4239=='string')return _0x2d4239;if(_0x2d4239 instanceof Error)return JSON['stringify']({'name':_0x2d4239['name'],'message':_0x2d4239['message'],'stack':_0x2d4239['stack']});if(typeof Request<'u'&&_0x2d4239 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x2d4239['url'],'method':_0x2d4239['method'],'headers':Object['fromEntries'](_0x2d4239['headers']['entries']()),'bodyUsed':_0x2d4239['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x2d4239 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x2d4239['status'],'headers':Object['fromEntries'](_0x2d4239['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x2d4239);}catch{return String(_0x2d4239);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x46ad18==='log'?'info':_0x46ad18,'message':_0x73f860,'meta':{'appId':s['appId']}});}catch{_0x934ea8(..._0x440246);}};}}R();async function v(_0xf4bc64){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x15b669=(await w(_0xf4bc64))['replace'](/\\/g,'/'),_0x53ff12=(_0x15b669['startsWith']('file://')?_0x15b669:'file://'+_0x15b669)+'?t='+Date['now']();try{let _0x729dde=await import(_0x53ff12);return s['module']=_0x729dde,_0x729dde;}catch(_0x1f4f93){throw console['error']('Failed to load module:',_0x1f4f93),_0x1f4f93;}}function b(_0x5813c0){return _0x5813c0 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x5813c0,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x3fe80c){return _0x3fe80c['split']('/')['filter'](_0x538a4c=>_0x538a4c['length']>0x0);}function E(_0x5447b6){try{return decodeURIComponent(_0x5447b6);}catch{return _0x5447b6;}}function I(_0x13d207,_0x3d7ca){let _0xb22f7=g(_0x13d207),_0x329afa=g(_0x3d7ca),_0x4a779b={},_0x427b39=0x0,_0x41ef51=0x0;for(;_0x427b39<_0xb22f7['length']&&_0x41ef51<_0x329afa['length'];){let _0xd20c15=_0xb22f7[_0x427b39],_0x7f73dd=_0x329afa[_0x41ef51];if(_0xd20c15==='*')break;if(_0xd20c15['startsWith'](':')){let _0x3856c7=_0xd20c15['slice'](0x1);_0x3856c7&&(_0x4a779b[_0x3856c7]=E(_0x7f73dd)),_0x427b39++,_0x41ef51++;continue;}if(_0xd20c15!==_0x7f73dd)return{};_0x427b39++,_0x41ef51++;}return _0x427b39===_0xb22f7['length']||_0x427b39===_0xb22f7['length']-0x1&&_0xb22f7[_0x427b39]==='*',_0x4a779b;}function M(_0x3cb5d5,_0xdd24c3){return _0x3cb5d5['startsWith']('/api')&&!_0xdd24c3['startsWith']('/api')?_0x3cb5d5['substring'](0x4)||'/':!_0x3cb5d5['startsWith']('/api')&&_0xdd24c3['startsWith']('/api')?'/api'+(_0x3cb5d5['startsWith']('/')?'':'/')+_0x3cb5d5:_0x3cb5d5;}async function W(_0x4dd324){let _0x443ccf=_0x4dd324['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x443ccf)&&await v(_0x443ccf);let _0x3c9ff4=_0x4dd324['ctx'],{method:_0x2dc331,pathname:_0x1ef20d}=_0x3c9ff4,_0xb9f68b=s['module']?.['default']||{},_0x2f8a37=m(_0xb9f68b,_0x2dc331,_0x1ef20d);if(!_0x2f8a37)throw Object['assign'](new Error('Route\x20'+_0x2dc331+'\x20'+_0x1ef20d+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x3926a5=k(_0x2f8a37),_0x419a79=c(_0x3c9ff4,s),_0x3cfc74=_0x1ef20d,_0x3bfb95=M(_0x3926a5['routePattern'],_0x3cfc74),_0x39e638=_0x3bfb95?I(_0x3bfb95,_0x3cfc74):{},_0x1bbad0=await _0x3926a5['handler']({..._0x419a79,'params':{..._0x419a79['params'],..._0x39e638}});return b(_0x1bbad0);}function D(_0x7c9add){s['appId']=_0x7c9add['appId'],s['manifest']=_0x7c9add['manifest'],s['appsDir']=_0x7c9add['appsDir'],s['serverPath']=_0x7c9add['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x2a5df5){let {reqId:_0xbf5870,payload:_0x48f6c8}=_0x2a5df5;try{let _0x2a8d63=await W(_0x48f6c8);self['postMessage']({'type':'result','reqId':_0xbf5870,'ok':!0x0,'response':_0x2a8d63});}catch(_0x169c21){let _0x5eeb5c=_0x169c21;self['postMessage']({'type':'result','reqId':_0xbf5870,'ok':![],'error':{'message':_0x5eeb5c['message'],'stack':_0x5eeb5c['stack'],'code':_0x5eeb5c['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x2ac494=>{let _0x45870a=_0x2ac494['data'];try{switch(_0x45870a['type']){case'init':D(_0x45870a);break;case'invoke':await $(_0x45870a);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x45870a['type']);break;}}catch(_0x519c98){let _0x1afda3=_0x519c98;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x1afda3['message'],'stack':_0x1afda3['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x1afda3);}}},self['onerror']=_0x28b96c=>{let _0x17b183={'message':typeof _0x28b96c=='string'?_0x28b96c:_0x28b96c['message'],'filename':typeof _0x28b96c=='string'?void 0x0:_0x28b96c['filename'],'lineno':typeof _0x28b96c=='string'?void 0x0:_0x28b96c['lineno'],'colno':typeof _0x28b96c=='string'?void 0x0:_0x28b96c['colno'],'error':typeof _0x28b96c=='string'?void 0x0:_0x28b96c['error']?.['message'],'stack':typeof _0x28b96c=='string'?void 0x0:_0x28b96c['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x17b183);},self['onunhandledrejection']=_0x9b370d=>{let _0x1da704=_0x9b370d['reason'],_0x2bc323={'appId':s['appId'],'reason':_0x1da704 instanceof Error?_0x1da704['message']:String(_0x1da704),'stack':_0x1da704 instanceof Error?_0x1da704['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x2bc323);};