function c(_0x5b6325,_0x6862b3){let _0x58a5f2=Object['fromEntries'](Object['entries'](_0x5b6325['headers']||{})['map'](([_0x377647,_0x4e22ae])=>[_0x377647['toLowerCase'](),_0x4e22ae]));return{'id':_0x5b6325['app']['id']||_0x6862b3['appId']||'','name':_0x5b6325['app']['name']||'','version':_0x5b6325['app']['version']||'','description':_0x5b6325['app']['description']||'','metadata':{..._0x5b6325['metadata'],'permissions':_0x5b6325['permissions']},'body':_0x5b6325['body'],'query':_0x5b6325['query'],'params':_0x5b6325?.['params'],'method':_0x5b6325['method'],'pathname':_0x5b6325['pathname'],'requestUrl':_0x5b6325['requestUrl'],'user':_0x5b6325['user'],'headers':_0x58a5f2};}function f(_0x3fb4b9){return _0x3fb4b9['split']('/')['filter'](_0x278515=>_0x278515['length']>0x0);}function P(_0x101dc3,_0x1c3922){let _0x492e8d=f(_0x101dc3),_0x4e3b5b=f(_0x1c3922),_0x582e28=0x0,_0x2ea3a1=0x0;for(;_0x582e28<_0x492e8d['length']&&_0x2ea3a1<_0x4e3b5b['length'];){let _0x2c0897=_0x492e8d[_0x582e28],_0x57e0b3=_0x4e3b5b[_0x2ea3a1];if(_0x2c0897==='*')return!![];if(_0x2c0897['startsWith'](':')){_0x582e28++,_0x2ea3a1++;continue;}if(_0x2c0897!==_0x57e0b3)return![];_0x582e28++,_0x2ea3a1++;}return _0x582e28===_0x492e8d['length']&&_0x2ea3a1===_0x4e3b5b['length']||_0x582e28===_0x492e8d['length']-0x1&&_0x492e8d[_0x582e28]==='*';}function m(_0x4a8180,_0x41e178,_0xdbf39c){let _0x40f78e=_0x41e178+'\x20'+_0xdbf39c;if(_0x4a8180[_0x40f78e])return{'handler':_0x4a8180[_0x40f78e],'routePattern':_0xdbf39c};let _0x510ee4=[];_0xdbf39c['startsWith']('/api')?_0x510ee4['push'](_0xdbf39c['substring'](0x4)||'/'):_0x510ee4['push']('/api'+_0xdbf39c),_0x510ee4['push'](_0xdbf39c);for(let _0x29f607 of _0x510ee4)for(let _0xaadbe8 of Object['keys'](_0x4a8180)){if(!_0xaadbe8['startsWith'](_0x41e178+'\x20'))continue;let _0x73e3e=_0xaadbe8['substring'](_0x41e178['length']+0x1);if(P(_0x73e3e,_0x29f607))return{'handler':_0x4a8180[_0xaadbe8],'routePattern':_0x73e3e};}return null;}function k(_0x5efab2){return typeof _0x5efab2=='function'?{'handler':_0x5efab2,'routePattern':''}:_0x5efab2;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x3fc0be){let _0x3abd6e=async _0x3ac35f=>{try{let _0x4aa06f=globalThis['Deno'];if(!_0x4aa06f)throw new Error('Deno is not available');return await _0x4aa06f['stat'](_0x3ac35f),!0x0;}catch{return![];}};if(_0x3fc0be&&typeof _0x3fc0be=='string'&&_0x3fc0be['length']>0x0)return _0x3fc0be;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x5b39ab=s['manifest']?.['metadata']?.['serverPath'];if(_0x5b39ab&&typeof _0x5b39ab=='string'&&_0x5b39ab['length']>0x0)return _0x5b39ab;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x3e546d=s['manifest']['name'];if(!_0x3e546d)throw new Error('Manifest\x20name\x20not\x20found');let _0x390d84=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x3e546d+'/server.js',s['appsDir']+'/'+_0x3e546d+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x91cdcf of _0x390d84)if(await _0x3abd6e(_0x91cdcf))return _0x91cdcf;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x390d84['join'](',\x20'));}function R(){let _0x178de7=['log','info','warn','error','debug','trace'];for(let _0x3e2b67 of _0x178de7){let _0x765929=(console[_0x3e2b67]||console['log'])['bind'](console);console[_0x3e2b67]=(..._0x63272)=>{try{let _0x31f027=_0x63272['map'](_0x58afef=>{if(typeof _0x58afef=='string')return _0x58afef;if(_0x58afef instanceof Error)return JSON['stringify']({'name':_0x58afef['name'],'message':_0x58afef['message'],'stack':_0x58afef['stack']});if(typeof Request<'u'&&_0x58afef instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x58afef['url'],'method':_0x58afef['method'],'headers':Object['fromEntries'](_0x58afef['headers']['entries']()),'bodyUsed':_0x58afef['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x58afef instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x58afef['status'],'headers':Object['fromEntries'](_0x58afef['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x58afef);}catch{return String(_0x58afef);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x3e2b67==='log'?'info':_0x3e2b67,'message':_0x31f027,'meta':{'appId':s['appId']}});}catch{_0x765929(..._0x63272);}};}}R();async function v(_0x2f3219){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x25e2e5=(await w(_0x2f3219))['replace'](/\\/g,'/'),_0xb718c7=(_0x25e2e5['startsWith']('file://')?_0x25e2e5:'file://'+_0x25e2e5)+'?t='+Date['now']();try{let _0x3967b3=await import(_0xb718c7);return s['module']=_0x3967b3,_0x3967b3;}catch(_0x5e7f4a){throw console['error']('Failed to load module:',_0x5e7f4a),_0x5e7f4a;}}function b(_0x55ed48){return _0x55ed48 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x55ed48,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x56530d){return _0x56530d['split']('/')['filter'](_0x5ef3d4=>_0x5ef3d4['length']>0x0);}function E(_0x41cf0d){try{return decodeURIComponent(_0x41cf0d);}catch{return _0x41cf0d;}}function I(_0x52d31a,_0x27a8b2){let _0x3be91d=g(_0x52d31a),_0x468257=g(_0x27a8b2),_0x518ff5={},_0x141b90=0x0,_0x5b683b=0x0;for(;_0x141b90<_0x3be91d['length']&&_0x5b683b<_0x468257['length'];){let _0x1f78f8=_0x3be91d[_0x141b90],_0x8ef48b=_0x468257[_0x5b683b];if(_0x1f78f8==='*')break;if(_0x1f78f8['startsWith'](':')){let _0x16abdc=_0x1f78f8['slice'](0x1);_0x16abdc&&(_0x518ff5[_0x16abdc]=E(_0x8ef48b)),_0x141b90++,_0x5b683b++;continue;}if(_0x1f78f8!==_0x8ef48b)return{};_0x141b90++,_0x5b683b++;}return _0x141b90===_0x3be91d['length']||_0x141b90===_0x3be91d['length']-0x1&&_0x3be91d[_0x141b90]==='*',_0x518ff5;}function M(_0x268867,_0x35cbef){return _0x268867['startsWith']('/api')&&!_0x35cbef['startsWith']('/api')?_0x268867['substring'](0x4)||'/':!_0x268867['startsWith']('/api')&&_0x35cbef['startsWith']('/api')?'/api'+(_0x268867['startsWith']('/')?'':'/')+_0x268867:_0x268867;}async function W(_0x35117b){let _0x40d538=_0x35117b['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x40d538)&&await v(_0x40d538);let _0x1bf073=_0x35117b['ctx'],{method:_0x19debd,pathname:_0x2caaaf}=_0x1bf073,_0x35dfdc=s['module']?.['default']||{},_0x3d855d=m(_0x35dfdc,_0x19debd,_0x2caaaf);if(!_0x3d855d)throw Object['assign'](new Error('Route\x20'+_0x19debd+'\x20'+_0x2caaaf+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x948d93=k(_0x3d855d),_0x34d3d0=c(_0x1bf073,s),_0x2eb1c7=_0x2caaaf,_0x28d5b6=M(_0x948d93['routePattern'],_0x2eb1c7),_0x3bcca6=_0x28d5b6?I(_0x28d5b6,_0x2eb1c7):{},_0x29a6a3=await _0x948d93['handler']({..._0x34d3d0,'params':{..._0x34d3d0['params'],..._0x3bcca6}});return b(_0x29a6a3);}function D(_0x20c63f){s['appId']=_0x20c63f['appId'],s['manifest']=_0x20c63f['manifest'],s['appsDir']=_0x20c63f['appsDir'],s['serverPath']=_0x20c63f['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x134861){let {reqId:_0x1cf5a1,payload:_0x1c9f0b}=_0x134861;try{let _0x59b0e3=await W(_0x1c9f0b);self['postMessage']({'type':'result','reqId':_0x1cf5a1,'ok':!0x0,'response':_0x59b0e3});}catch(_0x3305a1){let _0x430115=_0x3305a1;self['postMessage']({'type':'result','reqId':_0x1cf5a1,'ok':![],'error':{'message':_0x430115['message'],'stack':_0x430115['stack'],'code':_0x430115['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x15bdc1=>{let _0x46553a=_0x15bdc1['data'];try{switch(_0x46553a['type']){case'init':D(_0x46553a);break;case'invoke':await $(_0x46553a);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x46553a['type']);break;}}catch(_0x1ca394){let _0x248875=_0x1ca394;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x248875['message'],'stack':_0x248875['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x248875);}}},self['onerror']=_0x389991=>{let _0x4807a9={'message':typeof _0x389991=='string'?_0x389991:_0x389991['message'],'filename':typeof _0x389991=='string'?void 0x0:_0x389991['filename'],'lineno':typeof _0x389991=='string'?void 0x0:_0x389991['lineno'],'colno':typeof _0x389991=='string'?void 0x0:_0x389991['colno'],'error':typeof _0x389991=='string'?void 0x0:_0x389991['error']?.['message'],'stack':typeof _0x389991=='string'?void 0x0:_0x389991['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x4807a9);},self['onunhandledrejection']=_0x508eb3=>{let _0x1ff0b1=_0x508eb3['reason'],_0x42a18d={'appId':s['appId'],'reason':_0x1ff0b1 instanceof Error?_0x1ff0b1['message']:String(_0x1ff0b1),'stack':_0x1ff0b1 instanceof Error?_0x1ff0b1['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x42a18d);};