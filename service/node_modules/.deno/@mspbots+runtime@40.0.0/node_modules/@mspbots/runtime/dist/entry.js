function c(_0x2480c3,_0x4d5a1e){let _0x45be6b=Object['fromEntries'](Object['entries'](_0x2480c3['headers']||{})['map'](([_0x3e0f7c,_0x2571bf])=>[_0x3e0f7c['toLowerCase'](),_0x2571bf]));return{'id':_0x2480c3['app']['id']||_0x4d5a1e['appId']||'','name':_0x2480c3['app']['name']||'','version':_0x2480c3['app']['version']||'','description':_0x2480c3['app']['description']||'','metadata':{..._0x2480c3['metadata'],'permissions':_0x2480c3['permissions']},'body':_0x2480c3['body'],'query':_0x2480c3['query'],'params':_0x2480c3?.['params'],'method':_0x2480c3['method'],'pathname':_0x2480c3['pathname'],'requestUrl':_0x2480c3['requestUrl'],'user':_0x2480c3['user'],'headers':_0x45be6b};}function f(_0x478563){return _0x478563['split']('/')['filter'](_0x25c0f9=>_0x25c0f9['length']>0x0);}function P(_0x46bba3,_0x1057f7){let _0x1676ed=f(_0x46bba3),_0x1ecba9=f(_0x1057f7),_0x548986=0x0,_0x41ee69=0x0;for(;_0x548986<_0x1676ed['length']&&_0x41ee69<_0x1ecba9['length'];){let _0x39b37d=_0x1676ed[_0x548986],_0x9e5002=_0x1ecba9[_0x41ee69];if(_0x39b37d==='*')return!![];if(_0x39b37d['startsWith'](':')){_0x548986++,_0x41ee69++;continue;}if(_0x39b37d!==_0x9e5002)return![];_0x548986++,_0x41ee69++;}return _0x548986===_0x1676ed['length']&&_0x41ee69===_0x1ecba9['length']||_0x548986===_0x1676ed['length']-0x1&&_0x1676ed[_0x548986]==='*';}function m(_0x4266b4,_0x54250b,_0x235fde){let _0x380b2c=_0x54250b+'\x20'+_0x235fde;if(_0x4266b4[_0x380b2c])return{'handler':_0x4266b4[_0x380b2c],'routePattern':_0x235fde};let _0xa7aec1=[];_0x235fde['startsWith']('/api')?_0xa7aec1['push'](_0x235fde['substring'](0x4)||'/'):_0xa7aec1['push']('/api'+_0x235fde),_0xa7aec1['push'](_0x235fde);for(let _0x4b39e5 of _0xa7aec1)for(let _0x1cc475 of Object['keys'](_0x4266b4)){if(!_0x1cc475['startsWith'](_0x54250b+'\x20'))continue;let _0x26a2a2=_0x1cc475['substring'](_0x54250b['length']+0x1);if(P(_0x26a2a2,_0x4b39e5))return{'handler':_0x4266b4[_0x1cc475],'routePattern':_0x26a2a2};}return null;}function k(_0x40d1cb){return typeof _0x40d1cb=='function'?{'handler':_0x40d1cb,'routePattern':''}:_0x40d1cb;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x214e16){let _0x21322f=async _0x2ced54=>{try{let _0x169494=globalThis['Deno'];if(!_0x169494)throw new Error('Deno is not available');return await _0x169494['stat'](_0x2ced54),!0x0;}catch{return![];}};if(_0x214e16&&typeof _0x214e16=='string'&&_0x214e16['length']>0x0)return _0x214e16;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x1337bf=s['manifest']?.['metadata']?.['serverPath'];if(_0x1337bf&&typeof _0x1337bf=='string'&&_0x1337bf['length']>0x0)return _0x1337bf;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x3b4c5a=s['manifest']['name'];if(!_0x3b4c5a)throw new Error('Manifest\x20name\x20not\x20found');let _0x43623d=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x3b4c5a+'/server.js',s['appsDir']+'/'+_0x3b4c5a+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x47b3dc of _0x43623d)if(await _0x21322f(_0x47b3dc))return _0x47b3dc;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x43623d['join'](',\x20'));}function R(){let _0x3d8ba5=['log','info','warn','error','debug','trace'];for(let _0x50d832 of _0x3d8ba5){let _0xe25605=(console[_0x50d832]||console['log'])['bind'](console);console[_0x50d832]=(..._0x2bec1d)=>{try{let _0x4c89d9=_0x2bec1d['map'](_0x469f6e=>{if(typeof _0x469f6e=='string')return _0x469f6e;if(_0x469f6e instanceof Error)return JSON['stringify']({'name':_0x469f6e['name'],'message':_0x469f6e['message'],'stack':_0x469f6e['stack']});if(typeof Request<'u'&&_0x469f6e instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x469f6e['url'],'method':_0x469f6e['method'],'headers':Object['fromEntries'](_0x469f6e['headers']['entries']()),'bodyUsed':_0x469f6e['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x469f6e instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x469f6e['status'],'headers':Object['fromEntries'](_0x469f6e['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x469f6e);}catch{return String(_0x469f6e);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x50d832==='log'?'info':_0x50d832,'message':_0x4c89d9,'meta':{'appId':s['appId']}});}catch{_0xe25605(..._0x2bec1d);}};}}R();async function v(_0x2df0bc){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x3ed03c=(await w(_0x2df0bc))['replace'](/\\/g,'/'),_0x4973aa=(_0x3ed03c['startsWith']('file://')?_0x3ed03c:'file://'+_0x3ed03c)+'?t='+Date['now']();try{let _0x51d0b1=await import(_0x4973aa);return s['module']=_0x51d0b1,_0x51d0b1;}catch(_0xe5297a){throw console['error']('Failed to load module:',_0xe5297a),_0xe5297a;}}function b(_0x87c68a){return _0x87c68a instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x87c68a,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x4ac9f2){return _0x4ac9f2['split']('/')['filter'](_0x2c4633=>_0x2c4633['length']>0x0);}function E(_0x5bc4f0){try{return decodeURIComponent(_0x5bc4f0);}catch{return _0x5bc4f0;}}function I(_0x5e7cb7,_0x4d8802){let _0x5079c2=g(_0x5e7cb7),_0x2f0e20=g(_0x4d8802),_0xe994c2={},_0x5cb607=0x0,_0x34d93=0x0;for(;_0x5cb607<_0x5079c2['length']&&_0x34d93<_0x2f0e20['length'];){let _0x3e03fe=_0x5079c2[_0x5cb607],_0x2d82a4=_0x2f0e20[_0x34d93];if(_0x3e03fe==='*')break;if(_0x3e03fe['startsWith'](':')){let _0x2f8f5d=_0x3e03fe['slice'](0x1);_0x2f8f5d&&(_0xe994c2[_0x2f8f5d]=E(_0x2d82a4)),_0x5cb607++,_0x34d93++;continue;}if(_0x3e03fe!==_0x2d82a4)return{};_0x5cb607++,_0x34d93++;}return _0x5cb607===_0x5079c2['length']||_0x5cb607===_0x5079c2['length']-0x1&&_0x5079c2[_0x5cb607]==='*',_0xe994c2;}function M(_0x8429e5,_0x1a1272){return _0x8429e5['startsWith']('/api')&&!_0x1a1272['startsWith']('/api')?_0x8429e5['substring'](0x4)||'/':!_0x8429e5['startsWith']('/api')&&_0x1a1272['startsWith']('/api')?'/api'+(_0x8429e5['startsWith']('/')?'':'/')+_0x8429e5:_0x8429e5;}async function W(_0x113f17){let _0x26a011=_0x113f17['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x26a011)&&await v(_0x26a011);let _0x5040d=_0x113f17['ctx'],{method:_0x48ae76,pathname:_0xe7029a}=_0x5040d,_0x4f2c88=s['module']?.['default']||{},_0x397660=m(_0x4f2c88,_0x48ae76,_0xe7029a);if(!_0x397660)throw Object['assign'](new Error('Route\x20'+_0x48ae76+'\x20'+_0xe7029a+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x2e7094=k(_0x397660),_0xc73ae9=c(_0x5040d,s),_0x35f382=_0xe7029a,_0x2be98b=M(_0x2e7094['routePattern'],_0x35f382),_0x59614e=_0x2be98b?I(_0x2be98b,_0x35f382):{},_0x50e7e7=await _0x2e7094['handler']({..._0xc73ae9,'params':{..._0xc73ae9['params'],..._0x59614e}});return b(_0x50e7e7);}function D(_0x5c252f){s['appId']=_0x5c252f['appId'],s['manifest']=_0x5c252f['manifest'],s['appsDir']=_0x5c252f['appsDir'],s['serverPath']=_0x5c252f['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x5acf6d){let {reqId:_0x56856c,payload:_0x2a405c}=_0x5acf6d;try{let _0x503640=await W(_0x2a405c);self['postMessage']({'type':'result','reqId':_0x56856c,'ok':!0x0,'response':_0x503640});}catch(_0x1443da){let _0x40d21a=_0x1443da;self['postMessage']({'type':'result','reqId':_0x56856c,'ok':![],'error':{'message':_0x40d21a['message'],'stack':_0x40d21a['stack'],'code':_0x40d21a['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x12e5d5=>{let _0xa985f0=_0x12e5d5['data'];try{switch(_0xa985f0['type']){case'init':D(_0xa985f0);break;case'invoke':await $(_0xa985f0);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0xa985f0['type']);break;}}catch(_0x578b40){let _0x304e31=_0x578b40;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x304e31['message'],'stack':_0x304e31['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x304e31);}}},self['onerror']=_0x49e873=>{let _0x32ff5d={'message':typeof _0x49e873=='string'?_0x49e873:_0x49e873['message'],'filename':typeof _0x49e873=='string'?void 0x0:_0x49e873['filename'],'lineno':typeof _0x49e873=='string'?void 0x0:_0x49e873['lineno'],'colno':typeof _0x49e873=='string'?void 0x0:_0x49e873['colno'],'error':typeof _0x49e873=='string'?void 0x0:_0x49e873['error']?.['message'],'stack':typeof _0x49e873=='string'?void 0x0:_0x49e873['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x32ff5d);},self['onunhandledrejection']=_0x48d6a2=>{let _0x4fc1a0=_0x48d6a2['reason'],_0x18129a={'appId':s['appId'],'reason':_0x4fc1a0 instanceof Error?_0x4fc1a0['message']:String(_0x4fc1a0),'stack':_0x4fc1a0 instanceof Error?_0x4fc1a0['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x18129a);};