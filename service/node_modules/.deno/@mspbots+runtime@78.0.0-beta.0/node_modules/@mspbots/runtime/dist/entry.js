function c(_0x214c5d,_0x565ab2){let _0x5a5da9=Object['fromEntries'](Object['entries'](_0x214c5d['headers']||{})['map'](([_0x2ca32d,_0x41e58a])=>[_0x2ca32d['toLowerCase'](),_0x41e58a]));return{'id':_0x214c5d['app']['id']||_0x565ab2['appId']||'','name':_0x214c5d['app']['name']||'','version':_0x214c5d['app']['version']||'','description':_0x214c5d['app']['description']||'','metadata':{..._0x214c5d['metadata'],'permissions':_0x214c5d['permissions']},'body':_0x214c5d['body'],'query':_0x214c5d['query'],'params':_0x214c5d?.['params'],'method':_0x214c5d['method'],'pathname':_0x214c5d['pathname'],'requestUrl':_0x214c5d['requestUrl'],'user':_0x214c5d['user'],'headers':_0x5a5da9};}function f(_0x562e59){return _0x562e59['split']('/')['filter'](_0x306e87=>_0x306e87['length']>0x0);}function P(_0x3e2b02,_0x30dd63){let _0x1ad674=f(_0x3e2b02),_0xa7a41a=f(_0x30dd63),_0x4ba730=0x0,_0x16728a=0x0;for(;_0x4ba730<_0x1ad674['length']&&_0x16728a<_0xa7a41a['length'];){let _0x517e79=_0x1ad674[_0x4ba730],_0x46140f=_0xa7a41a[_0x16728a];if(_0x517e79==='*')return!![];if(_0x517e79['startsWith'](':')){_0x4ba730++,_0x16728a++;continue;}if(_0x517e79!==_0x46140f)return![];_0x4ba730++,_0x16728a++;}return _0x4ba730===_0x1ad674['length']&&_0x16728a===_0xa7a41a['length']||_0x4ba730===_0x1ad674['length']-0x1&&_0x1ad674[_0x4ba730]==='*';}function m(_0x503002,_0x33f7c2,_0x4d2b00){let _0x4f0bf8=_0x33f7c2+'\x20'+_0x4d2b00;if(_0x503002[_0x4f0bf8])return{'handler':_0x503002[_0x4f0bf8],'routePattern':_0x4d2b00};let _0x2f213c=[];_0x4d2b00['startsWith']('/api')?_0x2f213c['push'](_0x4d2b00['substring'](0x4)||'/'):_0x2f213c['push']('/api'+_0x4d2b00),_0x2f213c['push'](_0x4d2b00);for(let _0x4d1d86 of _0x2f213c)for(let _0x59191a of Object['keys'](_0x503002)){if(!_0x59191a['startsWith'](_0x33f7c2+'\x20'))continue;let _0x30652b=_0x59191a['substring'](_0x33f7c2['length']+0x1);if(P(_0x30652b,_0x4d1d86))return{'handler':_0x503002[_0x59191a],'routePattern':_0x30652b};}return null;}function k(_0x5e0403){return typeof _0x5e0403=='function'?{'handler':_0x5e0403,'routePattern':''}:_0x5e0403;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x40a293){let _0x7cd383=async _0x4c8036=>{try{let _0xa6c9d6=globalThis['Deno'];if(!_0xa6c9d6)throw new Error('Deno is not available');return await _0xa6c9d6['stat'](_0x4c8036),!0x0;}catch{return![];}};if(_0x40a293&&typeof _0x40a293=='string'&&_0x40a293['length']>0x0)return _0x40a293;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x3d770b=s['manifest']?.['metadata']?.['serverPath'];if(_0x3d770b&&typeof _0x3d770b=='string'&&_0x3d770b['length']>0x0)return _0x3d770b;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x3d2906=s['manifest']['name'];if(!_0x3d2906)throw new Error('Manifest\x20name\x20not\x20found');let _0x4177c3=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x3d2906+'/server.js',s['appsDir']+'/'+_0x3d2906+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x43974d of _0x4177c3)if(await _0x7cd383(_0x43974d))return _0x43974d;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x4177c3['join'](',\x20'));}function R(){let _0x3d6a11=['log','info','warn','error','debug','trace'];for(let _0xb70278 of _0x3d6a11){let _0x3871a=(console[_0xb70278]||console['log'])['bind'](console);console[_0xb70278]=(..._0xbe8781)=>{try{let _0x446b92=_0xbe8781['map'](_0x235382=>{if(typeof _0x235382=='string')return _0x235382;if(_0x235382 instanceof Error)return JSON['stringify']({'name':_0x235382['name'],'message':_0x235382['message'],'stack':_0x235382['stack']});if(typeof Request<'u'&&_0x235382 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x235382['url'],'method':_0x235382['method'],'headers':Object['fromEntries'](_0x235382['headers']['entries']()),'bodyUsed':_0x235382['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x235382 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x235382['status'],'headers':Object['fromEntries'](_0x235382['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x235382);}catch{return String(_0x235382);}})['join']('\x20');self['postMessage']({'type':'log','level':_0xb70278==='log'?'info':_0xb70278,'message':_0x446b92,'meta':{'appId':s['appId']}});}catch{_0x3871a(..._0xbe8781);}};}}R();async function v(_0x20485d){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x457f3d=(await w(_0x20485d))['replace'](/\\/g,'/'),_0x36c7a7=(_0x457f3d['startsWith']('file://')?_0x457f3d:'file://'+_0x457f3d)+'?t='+Date['now']();try{let _0x4fc4d0=await import(_0x36c7a7);return s['module']=_0x4fc4d0,_0x4fc4d0;}catch(_0x17ce58){throw console['error']('Failed to load module:',_0x17ce58),_0x17ce58;}}function b(_0x5a51ac){return _0x5a51ac instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x5a51ac,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x116685){return _0x116685['split']('/')['filter'](_0x98bfcb=>_0x98bfcb['length']>0x0);}function E(_0x4b3ebe){try{return decodeURIComponent(_0x4b3ebe);}catch{return _0x4b3ebe;}}function I(_0x45523f,_0x83a20b){let _0x54ee99=g(_0x45523f),_0x573674=g(_0x83a20b),_0x428293={},_0x1db107=0x0,_0x1650dd=0x0;for(;_0x1db107<_0x54ee99['length']&&_0x1650dd<_0x573674['length'];){let _0x55b7cf=_0x54ee99[_0x1db107],_0x3ea886=_0x573674[_0x1650dd];if(_0x55b7cf==='*')break;if(_0x55b7cf['startsWith'](':')){let _0x2ebd70=_0x55b7cf['slice'](0x1);_0x2ebd70&&(_0x428293[_0x2ebd70]=E(_0x3ea886)),_0x1db107++,_0x1650dd++;continue;}if(_0x55b7cf!==_0x3ea886)return{};_0x1db107++,_0x1650dd++;}return _0x1db107===_0x54ee99['length']||_0x1db107===_0x54ee99['length']-0x1&&_0x54ee99[_0x1db107]==='*',_0x428293;}function M(_0x225807,_0x4b591f){return _0x225807['startsWith']('/api')&&!_0x4b591f['startsWith']('/api')?_0x225807['substring'](0x4)||'/':!_0x225807['startsWith']('/api')&&_0x4b591f['startsWith']('/api')?'/api'+(_0x225807['startsWith']('/')?'':'/')+_0x225807:_0x225807;}async function W(_0x23dca6){let _0xc4520b=_0x23dca6['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0xc4520b)&&await v(_0xc4520b);let _0x25c7e2=_0x23dca6['ctx'],{method:_0x50bae0,pathname:_0x191a91}=_0x25c7e2,_0x4a463b=s['module']?.['default']||{},_0x531492=m(_0x4a463b,_0x50bae0,_0x191a91);if(!_0x531492)throw Object['assign'](new Error('Route\x20'+_0x50bae0+'\x20'+_0x191a91+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x1da44d=k(_0x531492),_0x1159d7=c(_0x25c7e2,s),_0x41eba1=_0x191a91,_0x14ecd4=M(_0x1da44d['routePattern'],_0x41eba1),_0x533ef3=_0x14ecd4?I(_0x14ecd4,_0x41eba1):{},_0x43eb58=await _0x1da44d['handler']({..._0x1159d7,'params':{..._0x1159d7['params'],..._0x533ef3}});return b(_0x43eb58);}function D(_0x121c9e){s['appId']=_0x121c9e['appId'],s['manifest']=_0x121c9e['manifest'],s['appsDir']=_0x121c9e['appsDir'],s['serverPath']=_0x121c9e['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x15789b){let {reqId:_0x5d4d2b,payload:_0x27dc7b}=_0x15789b;try{let _0x4e0c5c=await W(_0x27dc7b);self['postMessage']({'type':'result','reqId':_0x5d4d2b,'ok':!0x0,'response':_0x4e0c5c});}catch(_0x1f5cc2){let _0x42d454=_0x1f5cc2;self['postMessage']({'type':'result','reqId':_0x5d4d2b,'ok':![],'error':{'message':_0x42d454['message'],'stack':_0x42d454['stack'],'code':_0x42d454['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x218ece=>{let _0x59d1db=_0x218ece['data'];try{switch(_0x59d1db['type']){case'init':D(_0x59d1db);break;case'invoke':await $(_0x59d1db);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x59d1db['type']);break;}}catch(_0x104abf){let _0x42fdd0=_0x104abf;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x42fdd0['message'],'stack':_0x42fdd0['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x42fdd0);}}},self['onerror']=_0x5ec885=>{let _0x1f2060={'message':typeof _0x5ec885=='string'?_0x5ec885:_0x5ec885['message'],'filename':typeof _0x5ec885=='string'?void 0x0:_0x5ec885['filename'],'lineno':typeof _0x5ec885=='string'?void 0x0:_0x5ec885['lineno'],'colno':typeof _0x5ec885=='string'?void 0x0:_0x5ec885['colno'],'error':typeof _0x5ec885=='string'?void 0x0:_0x5ec885['error']?.['message'],'stack':typeof _0x5ec885=='string'?void 0x0:_0x5ec885['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x1f2060);},self['onunhandledrejection']=_0x5129d1=>{let _0x2ff984=_0x5129d1['reason'],_0x25b20b={'appId':s['appId'],'reason':_0x2ff984 instanceof Error?_0x2ff984['message']:String(_0x2ff984),'stack':_0x2ff984 instanceof Error?_0x2ff984['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x25b20b);};