function c(_0x247ada,_0x371a64){let _0x4d5b48=Object['fromEntries'](Object['entries'](_0x247ada['headers']||{})['map'](([_0x2def24,_0x5f387f])=>[_0x2def24['toLowerCase'](),_0x5f387f]));return{'id':_0x247ada['app']['id']||_0x371a64['appId']||'','name':_0x247ada['app']['name']||'','version':_0x247ada['app']['version']||'','description':_0x247ada['app']['description']||'','metadata':{..._0x247ada['metadata'],'permissions':_0x247ada['permissions']},'body':_0x247ada['body'],'query':_0x247ada['query'],'params':_0x247ada?.['params'],'method':_0x247ada['method'],'pathname':_0x247ada['pathname'],'requestUrl':_0x247ada['requestUrl'],'user':_0x247ada['user'],'headers':_0x4d5b48};}function f(_0x10406a){return _0x10406a['split']('/')['filter'](_0x1a91fb=>_0x1a91fb['length']>0x0);}function P(_0x1a3459,_0x330a26){let _0x194ed1=f(_0x1a3459),_0x48039d=f(_0x330a26),_0x41b71f=0x0,_0x580581=0x0;for(;_0x41b71f<_0x194ed1['length']&&_0x580581<_0x48039d['length'];){let _0x226b49=_0x194ed1[_0x41b71f],_0x4abd99=_0x48039d[_0x580581];if(_0x226b49==='*')return!![];if(_0x226b49['startsWith'](':')){_0x41b71f++,_0x580581++;continue;}if(_0x226b49!==_0x4abd99)return![];_0x41b71f++,_0x580581++;}return _0x41b71f===_0x194ed1['length']&&_0x580581===_0x48039d['length']||_0x41b71f===_0x194ed1['length']-0x1&&_0x194ed1[_0x41b71f]==='*';}function m(_0x17e5ad,_0x48bdb1,_0x3f7ca4){let _0x186d7f=_0x48bdb1+'\x20'+_0x3f7ca4;if(_0x17e5ad[_0x186d7f])return{'handler':_0x17e5ad[_0x186d7f],'routePattern':_0x3f7ca4};let _0x44551b=[];_0x3f7ca4['startsWith']('/api')?_0x44551b['push'](_0x3f7ca4['substring'](0x4)||'/'):_0x44551b['push']('/api'+_0x3f7ca4),_0x44551b['push'](_0x3f7ca4);for(let _0x47d459 of _0x44551b)for(let _0x1936e8 of Object['keys'](_0x17e5ad)){if(!_0x1936e8['startsWith'](_0x48bdb1+'\x20'))continue;let _0x2f3412=_0x1936e8['substring'](_0x48bdb1['length']+0x1);if(P(_0x2f3412,_0x47d459))return{'handler':_0x17e5ad[_0x1936e8],'routePattern':_0x2f3412};}return null;}function k(_0x4602b6){return typeof _0x4602b6=='function'?{'handler':_0x4602b6,'routePattern':''}:_0x4602b6;}var n={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return n['appId'];},get 'manifest'(){return n['manifest'];}};async function w(_0x575352){let _0x4e92d5=async _0x2c4dd5=>{try{let _0x204cb0=globalThis['Deno'];if(!_0x204cb0)throw new Error('Deno is not available');return await _0x204cb0['stat'](_0x2c4dd5),!0x0;}catch{return![];}};if(_0x575352&&typeof _0x575352=='string'&&_0x575352['length']>0x0)return _0x575352;if(n['serverPath']&&typeof n['serverPath']=='string'&&n['serverPath']['length']>0x0)return n['serverPath'];let _0x49e6d0=n['manifest']?.['metadata']?.['serverPath'];if(_0x49e6d0&&typeof _0x49e6d0=='string'&&_0x49e6d0['length']>0x0)return _0x49e6d0;if(!n['appsDir']||!n['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x408462=n['manifest']['name'];if(!_0x408462)throw new Error('Manifest\x20name\x20not\x20found');let _0x1a7dff=[n['appsDir']+'/service/server.js',n['appsDir']+'/service/server.ts',n['appsDir']+'/'+_0x408462+'/server.js',n['appsDir']+'/'+_0x408462+'/server.ts',n['appsDir']+'/server.ts',n['appsDir']+'/server.js'];for(let _0x57e60f of _0x1a7dff)if(await _0x4e92d5(_0x57e60f))return _0x57e60f;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x1a7dff['join'](',\x20'));}function R(){let _0xdffe30=['log','info','warn','error','debug'];for(let _0x364cd1 of _0xdffe30){let _0x4db0be=(console[_0x364cd1]||console['log'])['bind'](console);console[_0x364cd1]=(..._0x1a17d2)=>{try{let _0x155aa7=_0x1a17d2['map'](_0x356414=>{if(typeof _0x356414=='string')return _0x356414;if(_0x356414 instanceof Error)return JSON['stringify']({'name':_0x356414['name'],'message':_0x356414['message'],'stack':_0x356414['stack']});if(typeof Request<'u'&&_0x356414 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x356414['url'],'method':_0x356414['method'],'headers':Object['fromEntries'](_0x356414['headers']['entries']()),'bodyUsed':_0x356414['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x356414 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x356414['status'],'headers':Object['fromEntries'](_0x356414['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x356414);}catch{return String(_0x356414);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x364cd1==='log'?'info':_0x364cd1,'message':_0x155aa7,'meta':{'appId':n['appId']}});}catch{_0x4db0be(..._0x1a17d2);}};}}R();async function v(_0x1f2d51){if(!n['appId']||!n['appsDir']||!n['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x2dd424=(await w(_0x1f2d51))['replace'](/\\/g,'/'),_0x42d933=(_0x2dd424['startsWith']('file://')?_0x2dd424:'file://'+_0x2dd424)+'?t='+Date['now']();try{let _0x1d384e=await import(_0x42d933);return n['module']=_0x1d384e,_0x1d384e;}catch(_0x37dfe9){throw console['error']('Failed to load module:',_0x37dfe9),_0x37dfe9;}}function b(_0x2ec590){return _0x2ec590 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x2ec590,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x38585b){return _0x38585b['split']('/')['filter'](_0x14f7d8=>_0x14f7d8['length']>0x0);}function E(_0x24b9da){try{return decodeURIComponent(_0x24b9da);}catch{return _0x24b9da;}}function I(_0x331266,_0x560ad2){let _0xf652e6=g(_0x331266),_0x1348d8=g(_0x560ad2),_0x3e997a={},_0x4d9727=0x0,_0x36a426=0x0;for(;_0x4d9727<_0xf652e6['length']&&_0x36a426<_0x1348d8['length'];){let _0x4be2da=_0xf652e6[_0x4d9727],_0x15e1e0=_0x1348d8[_0x36a426];if(_0x4be2da==='*')break;if(_0x4be2da['startsWith'](':')){let _0x5c10a0=_0x4be2da['slice'](0x1);_0x5c10a0&&(_0x3e997a[_0x5c10a0]=E(_0x15e1e0)),_0x4d9727++,_0x36a426++;continue;}if(_0x4be2da!==_0x15e1e0)return{};_0x4d9727++,_0x36a426++;}return _0x4d9727===_0xf652e6['length']||_0x4d9727===_0xf652e6['length']-0x1&&_0xf652e6[_0x4d9727]==='*',_0x3e997a;}function M(_0x395906,_0x2ca124){return _0x395906['startsWith']('/api')&&!_0x2ca124['startsWith']('/api')?_0x395906['substring'](0x4)||'/':!_0x395906['startsWith']('/api')&&_0x2ca124['startsWith']('/api')?'/api'+(_0x395906['startsWith']('/')?'':'/')+_0x395906:_0x395906;}async function W(_0x12dced){let _0x1e8432=_0x12dced['ctx']?.['metadata']?.['serverPath'];(!n['module']||_0x1e8432)&&await v(_0x1e8432);let _0x46140e=_0x12dced['ctx'],{method:_0x306b2b,pathname:_0x2e4401}=_0x46140e,_0x5229aa=n['module']?.['default']||{},_0x4e6ab8=m(_0x5229aa,_0x306b2b,_0x2e4401);if(!_0x4e6ab8)throw Object['assign'](new Error('Route\x20'+_0x306b2b+'\x20'+_0x2e4401+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x3f033c=k(_0x4e6ab8),_0x217f89=c(_0x46140e,n),_0x294abd=_0x2e4401,_0x34bf0a=M(_0x3f033c['routePattern'],_0x294abd),_0x53dbea=_0x34bf0a?I(_0x34bf0a,_0x294abd):{},_0x322dd7=await _0x3f033c['handler']({..._0x217f89,'params':{..._0x217f89['params'],..._0x53dbea}});return b(_0x322dd7);}function D(_0x3a4d91){n['appId']=_0x3a4d91['appId'],n['manifest']=_0x3a4d91['manifest'],n['appsDir']=_0x3a4d91['appsDir'],n['serverPath']=_0x3a4d91['serverPath']||null,console['log']('Worker\x20initialized',{'appId':n['appId']}),self['postMessage']({'type':'ready','appId':n['appId']});}async function $(_0x4f9a7d){let {reqId:_0x17b909,payload:_0x5ee53b}=_0x4f9a7d;try{let _0x2e849a=await W(_0x5ee53b);self['postMessage']({'type':'result','reqId':_0x17b909,'ok':!0x0,'response':_0x2e849a});}catch(_0x228112){let _0x14838a=_0x228112;self['postMessage']({'type':'result','reqId':_0x17b909,'ok':![],'error':{'message':_0x14838a['message'],'stack':_0x14838a['stack'],'code':_0x14838a['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':n['appId']}),n['module']=null,n['appId']=null,n['manifest']=null,n['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x1c1fc7=>{let _0x186951=_0x1c1fc7['data'];try{switch(_0x186951['type']){case'init':D(_0x186951);break;case'invoke':await $(_0x186951);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x186951['type']);break;}}catch(_0x4096d3){let _0x4aa4d0=_0x4096d3;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':n['appId'],'error':_0x4aa4d0['message'],'stack':_0x4aa4d0['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x4aa4d0);}}},self['onerror']=_0x2b0f71=>{let _0x4376f9={'message':typeof _0x2b0f71=='string'?_0x2b0f71:_0x2b0f71['message'],'filename':typeof _0x2b0f71=='string'?void 0x0:_0x2b0f71['filename'],'lineno':typeof _0x2b0f71=='string'?void 0x0:_0x2b0f71['lineno'],'colno':typeof _0x2b0f71=='string'?void 0x0:_0x2b0f71['colno'],'error':typeof _0x2b0f71=='string'?void 0x0:_0x2b0f71['error']?.['message'],'stack':typeof _0x2b0f71=='string'?void 0x0:_0x2b0f71['error']?.['stack'],'appId':n['appId']};console['error']('Worker\x20global\x20error:',_0x4376f9);},self['onunhandledrejection']=_0x2231ac=>{let _0x7ea5c5=_0x2231ac['reason'],_0x3950ad={'appId':n['appId'],'reason':_0x7ea5c5 instanceof Error?_0x7ea5c5['message']:String(_0x7ea5c5),'stack':_0x7ea5c5 instanceof Error?_0x7ea5c5['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x3950ad);};