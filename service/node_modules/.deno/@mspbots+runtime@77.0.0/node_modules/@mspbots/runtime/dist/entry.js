function c(_0x2830d1,_0xed23a5){let _0x3971ce=Object['fromEntries'](Object['entries'](_0x2830d1['headers']||{})['map'](([_0x302e2e,_0x7a5a5b])=>[_0x302e2e['toLowerCase'](),_0x7a5a5b]));return{'id':_0x2830d1['app']['id']||_0xed23a5['appId']||'','name':_0x2830d1['app']['name']||'','version':_0x2830d1['app']['version']||'','description':_0x2830d1['app']['description']||'','metadata':{..._0x2830d1['metadata'],'permissions':_0x2830d1['permissions']},'body':_0x2830d1['body'],'query':_0x2830d1['query'],'params':_0x2830d1?.['params'],'method':_0x2830d1['method'],'pathname':_0x2830d1['pathname'],'requestUrl':_0x2830d1['requestUrl'],'user':_0x2830d1['user'],'headers':_0x3971ce};}function f(_0x1792b3){return _0x1792b3['split']('/')['filter'](_0x1b15a8=>_0x1b15a8['length']>0x0);}function P(_0xa013f1,_0x168b9d){let _0x2b367d=f(_0xa013f1),_0x333bb8=f(_0x168b9d),_0x194294=0x0,_0x17ae01=0x0;for(;_0x194294<_0x2b367d['length']&&_0x17ae01<_0x333bb8['length'];){let _0x465d65=_0x2b367d[_0x194294],_0x4a3c33=_0x333bb8[_0x17ae01];if(_0x465d65==='*')return!![];if(_0x465d65['startsWith'](':')){_0x194294++,_0x17ae01++;continue;}if(_0x465d65!==_0x4a3c33)return![];_0x194294++,_0x17ae01++;}return _0x194294===_0x2b367d['length']&&_0x17ae01===_0x333bb8['length']||_0x194294===_0x2b367d['length']-0x1&&_0x2b367d[_0x194294]==='*';}function m(_0x8e127,_0x5b806d,_0xc763d8){let _0x4dbfa1=_0x5b806d+'\x20'+_0xc763d8;if(_0x8e127[_0x4dbfa1])return{'handler':_0x8e127[_0x4dbfa1],'routePattern':_0xc763d8};let _0x1c24e7=[];_0xc763d8['startsWith']('/api')?_0x1c24e7['push'](_0xc763d8['substring'](0x4)||'/'):_0x1c24e7['push']('/api'+_0xc763d8),_0x1c24e7['push'](_0xc763d8);for(let _0x358fb1 of _0x1c24e7)for(let _0x4ec961 of Object['keys'](_0x8e127)){if(!_0x4ec961['startsWith'](_0x5b806d+'\x20'))continue;let _0x823606=_0x4ec961['substring'](_0x5b806d['length']+0x1);if(P(_0x823606,_0x358fb1))return{'handler':_0x8e127[_0x4ec961],'routePattern':_0x823606};}return null;}function k(_0x14e522){return typeof _0x14e522=='function'?{'handler':_0x14e522,'routePattern':''}:_0x14e522;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x41506b){let _0x192048=async _0x2c60a8=>{try{let _0x3cd0bd=globalThis['Deno'];if(!_0x3cd0bd)throw new Error('Deno is not available');return await _0x3cd0bd['stat'](_0x2c60a8),!0x0;}catch{return![];}};if(_0x41506b&&typeof _0x41506b=='string'&&_0x41506b['length']>0x0)return _0x41506b;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x28e07=s['manifest']?.['metadata']?.['serverPath'];if(_0x28e07&&typeof _0x28e07=='string'&&_0x28e07['length']>0x0)return _0x28e07;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x2e11df=s['manifest']['name'];if(!_0x2e11df)throw new Error('Manifest\x20name\x20not\x20found');let _0x5af129=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x2e11df+'/server.js',s['appsDir']+'/'+_0x2e11df+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x207e30 of _0x5af129)if(await _0x192048(_0x207e30))return _0x207e30;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x5af129['join'](',\x20'));}function R(){let _0x372fb4=['log','info','warn','error','debug','trace'];for(let _0xcf3075 of _0x372fb4){let _0x1ac7c1=(console[_0xcf3075]||console['log'])['bind'](console);console[_0xcf3075]=(..._0x20f9f0)=>{try{let _0x84a72e=_0x20f9f0['map'](_0x134d4c=>{if(typeof _0x134d4c=='string')return _0x134d4c;if(_0x134d4c instanceof Error)return JSON['stringify']({'name':_0x134d4c['name'],'message':_0x134d4c['message'],'stack':_0x134d4c['stack']});if(typeof Request<'u'&&_0x134d4c instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x134d4c['url'],'method':_0x134d4c['method'],'headers':Object['fromEntries'](_0x134d4c['headers']['entries']()),'bodyUsed':_0x134d4c['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x134d4c instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x134d4c['status'],'headers':Object['fromEntries'](_0x134d4c['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x134d4c);}catch{return String(_0x134d4c);}})['join']('\x20');self['postMessage']({'type':'log','level':_0xcf3075==='log'?'info':_0xcf3075,'message':_0x84a72e,'meta':{'appId':s['appId']}});}catch{_0x1ac7c1(..._0x20f9f0);}};}}R();async function v(_0x1c0d8c){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x429459=(await w(_0x1c0d8c))['replace'](/\\/g,'/'),_0x395363=(_0x429459['startsWith']('file://')?_0x429459:'file://'+_0x429459)+'?t='+Date['now']();try{let _0x1ee941=await import(_0x395363);return s['module']=_0x1ee941,_0x1ee941;}catch(_0x4de12e){throw console['error']('Failed to load module:',_0x4de12e),_0x4de12e;}}function b(_0x1a0b77){return _0x1a0b77 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0x1a0b77,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x4bd196){return _0x4bd196['split']('/')['filter'](_0x10b837=>_0x10b837['length']>0x0);}function E(_0x4b74c7){try{return decodeURIComponent(_0x4b74c7);}catch{return _0x4b74c7;}}function I(_0x32ba45,_0x469be3){let _0x476c60=g(_0x32ba45),_0x1df0e8=g(_0x469be3),_0x5537e2={},_0x3abab8=0x0,_0x56e85d=0x0;for(;_0x3abab8<_0x476c60['length']&&_0x56e85d<_0x1df0e8['length'];){let _0x94cb37=_0x476c60[_0x3abab8],_0x4c6e91=_0x1df0e8[_0x56e85d];if(_0x94cb37==='*')break;if(_0x94cb37['startsWith'](':')){let _0x421a43=_0x94cb37['slice'](0x1);_0x421a43&&(_0x5537e2[_0x421a43]=E(_0x4c6e91)),_0x3abab8++,_0x56e85d++;continue;}if(_0x94cb37!==_0x4c6e91)return{};_0x3abab8++,_0x56e85d++;}return _0x3abab8===_0x476c60['length']||_0x3abab8===_0x476c60['length']-0x1&&_0x476c60[_0x3abab8]==='*',_0x5537e2;}function M(_0x355dd9,_0x33f6f2){return _0x355dd9['startsWith']('/api')&&!_0x33f6f2['startsWith']('/api')?_0x355dd9['substring'](0x4)||'/':!_0x355dd9['startsWith']('/api')&&_0x33f6f2['startsWith']('/api')?'/api'+(_0x355dd9['startsWith']('/')?'':'/')+_0x355dd9:_0x355dd9;}async function W(_0xf75e06){let _0x58b3db=_0xf75e06['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x58b3db)&&await v(_0x58b3db);let _0x257077=_0xf75e06['ctx'],{method:_0x411965,pathname:_0x2ec6e1}=_0x257077,_0x19169f=s['module']?.['default']||{},_0x49811f=m(_0x19169f,_0x411965,_0x2ec6e1);if(!_0x49811f)throw Object['assign'](new Error('Route\x20'+_0x411965+'\x20'+_0x2ec6e1+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x418bc7=k(_0x49811f),_0x2daf4f=c(_0x257077,s),_0x250526=_0x2ec6e1,_0x5ee340=M(_0x418bc7['routePattern'],_0x250526),_0x278621=_0x5ee340?I(_0x5ee340,_0x250526):{},_0x5e3fad=await _0x418bc7['handler']({..._0x2daf4f,'params':{..._0x2daf4f['params'],..._0x278621}});return b(_0x5e3fad);}function D(_0x47720b){s['appId']=_0x47720b['appId'],s['manifest']=_0x47720b['manifest'],s['appsDir']=_0x47720b['appsDir'],s['serverPath']=_0x47720b['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x32473a){let {reqId:_0x57e9b5,payload:_0x142003}=_0x32473a;try{let _0x2784f4=await W(_0x142003);self['postMessage']({'type':'result','reqId':_0x57e9b5,'ok':!0x0,'response':_0x2784f4});}catch(_0x497c59){let _0x4d2f00=_0x497c59;self['postMessage']({'type':'result','reqId':_0x57e9b5,'ok':![],'error':{'message':_0x4d2f00['message'],'stack':_0x4d2f00['stack'],'code':_0x4d2f00['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x11413f=>{let _0x6d64aa=_0x11413f['data'];try{switch(_0x6d64aa['type']){case'init':D(_0x6d64aa);break;case'invoke':await $(_0x6d64aa);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x6d64aa['type']);break;}}catch(_0x1d384f){let _0x578aa4=_0x1d384f;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x578aa4['message'],'stack':_0x578aa4['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x578aa4);}}},self['onerror']=_0xd9c279=>{let _0x29783c={'message':typeof _0xd9c279=='string'?_0xd9c279:_0xd9c279['message'],'filename':typeof _0xd9c279=='string'?void 0x0:_0xd9c279['filename'],'lineno':typeof _0xd9c279=='string'?void 0x0:_0xd9c279['lineno'],'colno':typeof _0xd9c279=='string'?void 0x0:_0xd9c279['colno'],'error':typeof _0xd9c279=='string'?void 0x0:_0xd9c279['error']?.['message'],'stack':typeof _0xd9c279=='string'?void 0x0:_0xd9c279['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x29783c);},self['onunhandledrejection']=_0x48913c=>{let _0x8108b5=_0x48913c['reason'],_0x44f368={'appId':s['appId'],'reason':_0x8108b5 instanceof Error?_0x8108b5['message']:String(_0x8108b5),'stack':_0x8108b5 instanceof Error?_0x8108b5['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x44f368);};