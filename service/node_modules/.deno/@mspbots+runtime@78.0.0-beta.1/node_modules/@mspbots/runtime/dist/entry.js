function c(_0xa1a12e,_0x3927ba){let _0xf8e4a3=Object['fromEntries'](Object['entries'](_0xa1a12e['headers']||{})['map'](([_0x2e2fe9,_0x3c00b2])=>[_0x2e2fe9['toLowerCase'](),_0x3c00b2]));return{'id':_0xa1a12e['app']['id']||_0x3927ba['appId']||'','name':_0xa1a12e['app']['name']||'','version':_0xa1a12e['app']['version']||'','description':_0xa1a12e['app']['description']||'','metadata':{..._0xa1a12e['metadata'],'permissions':_0xa1a12e['permissions']},'body':_0xa1a12e['body'],'query':_0xa1a12e['query'],'params':_0xa1a12e?.['params'],'method':_0xa1a12e['method'],'pathname':_0xa1a12e['pathname'],'requestUrl':_0xa1a12e['requestUrl'],'user':_0xa1a12e['user'],'headers':_0xf8e4a3};}function f(_0x27529b){return _0x27529b['split']('/')['filter'](_0x3263a9=>_0x3263a9['length']>0x0);}function P(_0x50510e,_0x4d1804){let _0x3a6659=f(_0x50510e),_0xc86ab8=f(_0x4d1804),_0x1472bd=0x0,_0x281a99=0x0;for(;_0x1472bd<_0x3a6659['length']&&_0x281a99<_0xc86ab8['length'];){let _0x3c5a3a=_0x3a6659[_0x1472bd],_0x3a940f=_0xc86ab8[_0x281a99];if(_0x3c5a3a==='*')return!![];if(_0x3c5a3a['startsWith'](':')){_0x1472bd++,_0x281a99++;continue;}if(_0x3c5a3a!==_0x3a940f)return![];_0x1472bd++,_0x281a99++;}return _0x1472bd===_0x3a6659['length']&&_0x281a99===_0xc86ab8['length']||_0x1472bd===_0x3a6659['length']-0x1&&_0x3a6659[_0x1472bd]==='*';}function m(_0x5b9b18,_0x19460f,_0x61dfa7){let _0x1af9c3=_0x19460f+'\x20'+_0x61dfa7;if(_0x5b9b18[_0x1af9c3])return{'handler':_0x5b9b18[_0x1af9c3],'routePattern':_0x61dfa7};let _0x161948=[];_0x61dfa7['startsWith']('/api')?_0x161948['push'](_0x61dfa7['substring'](0x4)||'/'):_0x161948['push']('/api'+_0x61dfa7),_0x161948['push'](_0x61dfa7);for(let _0x31cddc of _0x161948)for(let _0x3341f4 of Object['keys'](_0x5b9b18)){if(!_0x3341f4['startsWith'](_0x19460f+'\x20'))continue;let _0x8170c3=_0x3341f4['substring'](_0x19460f['length']+0x1);if(P(_0x8170c3,_0x31cddc))return{'handler':_0x5b9b18[_0x3341f4],'routePattern':_0x8170c3};}return null;}function k(_0x117fb8){return typeof _0x117fb8=='function'?{'handler':_0x117fb8,'routePattern':''}:_0x117fb8;}var s={'appId':null,'manifest':null,'appsDir':null,'module':null,'serverPath':null};globalThis['WorkerCtx']={get 'appId'(){return s['appId'];},get 'manifest'(){return s['manifest'];}};async function w(_0x5a49c1){let _0x3f055a=async _0x236b56=>{try{let _0x36da89=globalThis['Deno'];if(!_0x36da89)throw new Error('Deno is not available');return await _0x36da89['stat'](_0x236b56),!0x0;}catch{return![];}};if(_0x5a49c1&&typeof _0x5a49c1=='string'&&_0x5a49c1['length']>0x0)return _0x5a49c1;if(s['serverPath']&&typeof s['serverPath']=='string'&&s['serverPath']['length']>0x0)return s['serverPath'];let _0x462c63=s['manifest']?.['metadata']?.['serverPath'];if(_0x462c63&&typeof _0x462c63=='string'&&_0x462c63['length']>0x0)return _0x462c63;if(!s['appsDir']||!s['manifest'])throw new Error('appsDir\x20or\x20manifest\x20not\x20initialized');let _0x3b4b63=s['manifest']['name'];if(!_0x3b4b63)throw new Error('Manifest\x20name\x20not\x20found');let _0x453c35=[s['appsDir']+'/service/server.js',s['appsDir']+'/service/server.ts',s['appsDir']+'/'+_0x3b4b63+'/server.js',s['appsDir']+'/'+_0x3b4b63+'/server.ts',s['appsDir']+'/server.ts',s['appsDir']+'/server.js'];for(let _0x228583 of _0x453c35)if(await _0x3f055a(_0x228583))return _0x228583;throw new Error('server\x20module\x20not\x20found.\x20tried:\x20'+_0x453c35['join'](',\x20'));}function R(){let _0x8a0c37=['log','info','warn','error','debug','trace'];for(let _0x55c22d of _0x8a0c37){let _0x346012=(console[_0x55c22d]||console['log'])['bind'](console);console[_0x55c22d]=(..._0x16946d)=>{try{let _0x277922=_0x16946d['map'](_0x49fc81=>{if(typeof _0x49fc81=='string')return _0x49fc81;if(_0x49fc81 instanceof Error)return JSON['stringify']({'name':_0x49fc81['name'],'message':_0x49fc81['message'],'stack':_0x49fc81['stack']});if(typeof Request<'u'&&_0x49fc81 instanceof Request)try{return JSON['stringify']({'type':'Request','url':_0x49fc81['url'],'method':_0x49fc81['method'],'headers':Object['fromEntries'](_0x49fc81['headers']['entries']()),'bodyUsed':_0x49fc81['bodyUsed']});}catch{return'[Request]';}if(typeof Response<'u'&&_0x49fc81 instanceof Response)try{return JSON['stringify']({'type':'Response','status':_0x49fc81['status'],'headers':Object['fromEntries'](_0x49fc81['headers']['entries']())});}catch{return'[Response]';}try{return JSON['stringify'](_0x49fc81);}catch{return String(_0x49fc81);}})['join']('\x20');self['postMessage']({'type':'log','level':_0x55c22d==='log'?'info':_0x55c22d,'message':_0x277922,'meta':{'appId':s['appId']}});}catch{_0x346012(..._0x16946d);}};}}R();async function v(_0x36af14){if(!s['appId']||!s['appsDir']||!s['manifest'])throw new Error('appId,\x20appsDir\x20or\x20manifest\x20not\x20initialized');let _0x40c908=(await w(_0x36af14))['replace'](/\\/g,'/'),_0x535ee4=(_0x40c908['startsWith']('file://')?_0x40c908:'file://'+_0x40c908)+'?t='+Date['now']();try{let _0x453639=await import(_0x535ee4);return s['module']=_0x453639,_0x453639;}catch(_0xe2175a){throw console['error']('Failed to load module:',_0xe2175a),_0xe2175a;}}function b(_0xf745e5){return _0xf745e5 instanceof Response?{'type':'raw','ok':!![],'body':'Response\x20object\x20not\x20transferable','status':0xc8,'headers':{}}:{'type':'json','ok':!![],'body':_0xf745e5,'status':0xc8,'headers':{'Content-Type':'application/json'}};}function g(_0x3b43b2){return _0x3b43b2['split']('/')['filter'](_0x23efc0=>_0x23efc0['length']>0x0);}function E(_0x33177d){try{return decodeURIComponent(_0x33177d);}catch{return _0x33177d;}}function I(_0x3329ce,_0x4956da){let _0x8bf24e=g(_0x3329ce),_0xae1c5c=g(_0x4956da),_0x241bf4={},_0xdf50f9=0x0,_0x22bc40=0x0;for(;_0xdf50f9<_0x8bf24e['length']&&_0x22bc40<_0xae1c5c['length'];){let _0x178aee=_0x8bf24e[_0xdf50f9],_0xffaea5=_0xae1c5c[_0x22bc40];if(_0x178aee==='*')break;if(_0x178aee['startsWith'](':')){let _0x5910f0=_0x178aee['slice'](0x1);_0x5910f0&&(_0x241bf4[_0x5910f0]=E(_0xffaea5)),_0xdf50f9++,_0x22bc40++;continue;}if(_0x178aee!==_0xffaea5)return{};_0xdf50f9++,_0x22bc40++;}return _0xdf50f9===_0x8bf24e['length']||_0xdf50f9===_0x8bf24e['length']-0x1&&_0x8bf24e[_0xdf50f9]==='*',_0x241bf4;}function M(_0x6d54f,_0x10496e){return _0x6d54f['startsWith']('/api')&&!_0x10496e['startsWith']('/api')?_0x6d54f['substring'](0x4)||'/':!_0x6d54f['startsWith']('/api')&&_0x10496e['startsWith']('/api')?'/api'+(_0x6d54f['startsWith']('/')?'':'/')+_0x6d54f:_0x6d54f;}async function W(_0xa7874f){let _0x3581e1=_0xa7874f['ctx']?.['metadata']?.['serverPath'];(!s['module']||_0x3581e1)&&await v(_0x3581e1);let _0x1ffd55=_0xa7874f['ctx'],{method:_0x288d27,pathname:_0x22c4dc}=_0x1ffd55,_0x121266=s['module']?.['default']||{},_0x919a99=m(_0x121266,_0x288d27,_0x22c4dc);if(!_0x919a99)throw Object['assign'](new Error('Route\x20'+_0x288d27+'\x20'+_0x22c4dc+'\x20not\x20found'),{'code':'ROUTE_NOT_FOUND'});let _0x157800=k(_0x919a99),_0x303a22=c(_0x1ffd55,s),_0x1ef723=_0x22c4dc,_0x2ccc1f=M(_0x157800['routePattern'],_0x1ef723),_0x3c338e=_0x2ccc1f?I(_0x2ccc1f,_0x1ef723):{},_0xcaf08f=await _0x157800['handler']({..._0x303a22,'params':{..._0x303a22['params'],..._0x3c338e}});return b(_0xcaf08f);}function D(_0xbdb25c){s['appId']=_0xbdb25c['appId'],s['manifest']=_0xbdb25c['manifest'],s['appsDir']=_0xbdb25c['appsDir'],s['serverPath']=_0xbdb25c['serverPath']||null,console['log']('Worker\x20initialized',{'appId':s['appId']}),self['postMessage']({'type':'ready','appId':s['appId']});}async function $(_0x3486e3){let {reqId:_0x217b99,payload:_0x567602}=_0x3486e3;try{let _0x5061fe=await W(_0x567602);self['postMessage']({'type':'result','reqId':_0x217b99,'ok':!0x0,'response':_0x5061fe});}catch(_0x225c09){let _0x3249ea=_0x225c09;self['postMessage']({'type':'result','reqId':_0x217b99,'ok':![],'error':{'message':_0x3249ea['message'],'stack':_0x3249ea['stack'],'code':_0x3249ea['code']}});}}function C(){console['log']('Worker\x20shutting\x20down',{'appId':s['appId']}),s['module']=null,s['appId']=null,s['manifest']=null,s['appsDir']=null,self['postMessage']({'type':'shutdown-complete'});}self['onmessage']=async _0x9c438d=>{let _0x51789c=_0x9c438d['data'];try{switch(_0x51789c['type']){case'init':D(_0x51789c);break;case'invoke':await $(_0x51789c);break;case'shutdown':C();break;default:console['warn']('Unknown\x20message\x20type:',_0x51789c['type']);break;}}catch(_0x53f005){let _0x866fce=_0x53f005;try{self['postMessage']({'type':'log','level':'error','message':'Unhandled\x20error\x20in\x20worker','meta':{'appId':s['appId'],'error':_0x866fce['message'],'stack':_0x866fce['stack']}});}catch{console['error']('Failed\x20to\x20send\x20error:',_0x866fce);}}},self['onerror']=_0x2657ce=>{let _0x283c11={'message':typeof _0x2657ce=='string'?_0x2657ce:_0x2657ce['message'],'filename':typeof _0x2657ce=='string'?void 0x0:_0x2657ce['filename'],'lineno':typeof _0x2657ce=='string'?void 0x0:_0x2657ce['lineno'],'colno':typeof _0x2657ce=='string'?void 0x0:_0x2657ce['colno'],'error':typeof _0x2657ce=='string'?void 0x0:_0x2657ce['error']?.['message'],'stack':typeof _0x2657ce=='string'?void 0x0:_0x2657ce['error']?.['stack'],'appId':s['appId']};console['error']('Worker\x20global\x20error:',_0x283c11);},self['onunhandledrejection']=_0x228acc=>{let _0x1e81aa=_0x228acc['reason'],_0x258004={'appId':s['appId'],'reason':_0x1e81aa instanceof Error?_0x1e81aa['message']:String(_0x1e81aa),'stack':_0x1e81aa instanceof Error?_0x1e81aa['stack']:void 0x0};console['error']('Unhandled\x20promise\x20rejection:',_0x258004);};