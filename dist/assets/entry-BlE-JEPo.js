const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Topology-Dce0lKvZ.js","assets/vendor-react-DhQkf-0u.js","assets/vendor-libs-BVVzLCuo.js","assets/vendor-react-BZV40eAE.css"])))=>i.map(i=>d[i]);
import{H as S,r as f,w as c,$ as M,x as B,j as o,y as $,z as E,E as m,h as A,F as K,R as b,O as U,N as V}from"./vendor-react-DhQkf-0u.js";import{_ as W,L as x,A as _,u as H}from"./vendor-layout-CO2PkLx0.js";import"./vendor-ui-Bk2sRgsZ.js";import{ay as O,az as Y}from"./vendor-libs-BVVzLCuo.js";const d=[{name:"topology",path:"/",component:f.lazy(()=>W(()=>import("./Topology-Dce0lKvZ.js"),__vite__mapDeps([0,1,2,3]))),label:"Topology",icon:S,menu:!0,type:"main"}];function z(){const e=window.self!==window.parent,t=window.__WUJIE__,n=window.$wujie?.bus||t?.bus,s=c.isApp()||e;return{inIframe:e,isMicroApp:s,wujieInstance:t,wujieBus:n}}function G(e){return c.on("initial-config",t=>{if(t.layout&&typeof window<"u"&&window.dispatchEvent(new CustomEvent("layout-config-change",{detail:t.layout})),t.theme&&typeof window<"u"){const n=window.$wujie?.shadowRoot?.host||window.__WUJIE__?.shadowRoot?.host||window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(t.theme);try{localStorage.setItem("theme",t.theme)}catch{}e&&e(t.theme==="dark"?"dark":"light")}})}function F(e){return c.on("route-change",t=>{if(t?.path)try{e(t.path)}catch{}})}function J(e,t,n){if(!t||!n?.id)return()=>{};const s=`wujie:message:${n.id}:route-change`,r=i=>{const a=i.data||i;if(a?.path)try{e(a.path)}catch{}};return t.$on(s,r),()=>t.$off(s,r)}function Q(){return c.broadcast("layout-change",e=>{typeof window<"u"&&window.dispatchEvent(new CustomEvent("layout-config-change",{detail:{mode:e.mode,collapsible:e.collapsible,defaultCollapsed:e.defaultCollapsed}}))})}function q(e){return c.broadcast("theme-change",t=>{if(t.theme&&typeof window<"u"){const n=window.$wujie?.shadowRoot?.host||window.__WUJIE__?.shadowRoot?.host||window.document.documentElement;n.classList.remove("light","dark"),n.classList.add(t.theme);try{localStorage.setItem("theme",t.theme)}catch{}e&&e(t.theme==="dark"?"dark":"light")}})}function X(e){c.isApp()&&c.emit("ready",{timestamp:Date.now(),routes:e?.map(t=>({path:t.path,label:t.label}))||[]})}function Z(e){const{navigate:t,routes:n,setTheme:s}=e;f.useEffect(()=>{const r=z();if(!r.isMicroApp)return;const i=G(s),a=F(t),l=J(t,r.wujieBus,r.wujieInstance),L=Q(),N=q(s);return X(n),()=>{i(),a(),l(),L(),N()}},[t,n,s])}const v={};function ee(e){return e.replace(/^\//,"")}function te(e,t){if(!e.startsWith(t))return e;const n=e.slice(t.length);return n.startsWith("/")?n:"/"+n}function R(e,t){for(const n of e){if(n.path===t)return n;if(n.children){const s=R(n.children,t);if(s)return s}}}function ne(e){if(e)return e.endsWith("/*")?e:e+"/*"}const oe=`-----BEGIN PUBLIC KEY-----
MCowBQYDK2VwAyEAKTB/GlkyDMoP1mVjAXC8UftjdWqW77Qo1ot90ufLOJI=
-----END PUBLIC KEY-----`,u={enabled:!0,loginPath:"/apps/mb-platform-user/login"},D="__mspbots_auth_redirect__";function se(e){try{return new URL(e,window.location.origin).pathname}catch{return e}}function h(e){if(typeof window>"u")return!1;const t=se(e);if(!t)return!1;const n=window.location?.pathname||"";if(n===t||n.startsWith(t+"/"))return!1;try{if(sessionStorage.getItem(D)===e)return!1}catch{}return!0}function w(e){if(!(typeof window>"u")&&h(e)){try{sessionStorage.setItem(D,e)}catch{}window.location.href=e}}const P=f.createContext({roles:[],tokenPayload:null,isReady:!1});function re(e){const t=e?.roles;return Array.isArray(t)?t.filter(n=>typeof n=="string"&&n.trim()):[]}function k(e,t){return e===!1?!1:e===!0||e===void 0||!Array.isArray(e)?!0:e.length===0||!t.length?!1:e.some(n=>t.includes(n))}function g(e,t){const n=[];for(const s of e){if(!k(s.menu,t))continue;const r=Array.isArray(s.children)?g(s.children,t):void 0;n.push(r?{...s,children:r}:s)}return n}function I(e,t){if(!k(e.route,t))return!1;const s=Array.isArray(e.children)?e.children:[],r=s.length>0,i=!!e.component;return!r||i?!0:s.some(a=>I(a,t))}function T(){const e=v?.VITE_APP_TOKEN||v?.VITE_TOKEN;if(typeof e=="string"&&e.trim())return e.trim();const t=typeof window<"u"?localStorage.getItem("token"):null;if(t&&t.trim())return t.trim()}async function ie(e){try{const t=await O(oe,"EdDSA"),{payload:n}=await Y(e,t,{algorithms:["EdDSA"]});return n}catch{return null}}function y(){return f.useContext(P)}function ae({children:e}){const[t,n]=f.useState({roles:[],tokenPayload:null,isReady:!1});return f.useEffect(()=>{let s=!1;return(async()=>{const i=T();if(!i){if(h(u.loginPath)){w(u.loginPath);return}s||n({roles:[],tokenPayload:null,isReady:!0});return}const a=await ie(i);if(!a&&h(u.loginPath)){w(u.loginPath);return}const l=re(a);s||n({roles:l,tokenPayload:a,isReady:!0})})(),()=>{s=!0}},[]),o.jsx(P.Provider,{value:t,children:e})}function j({node:e,children:t}){const{roles:n,isReady:s}=y();return s?I(e,n)?o.jsx(o.Fragment,{children:t}):o.jsx(V,{to:"/403",replace:!0}):null}function C(){const e=A();return o.jsx("div",{className:"flex h-full w-full items-start justify-center bg-muted/5 p-6 md:p-10",children:o.jsx("div",{className:"w-full max-w-2xl overflow-hidden rounded-xl border bg-background shadow-sm",children:o.jsxs("div",{className:"flex flex-col gap-6 p-6 md:p-8",children:[o.jsxs("div",{className:"flex items-center gap-3",children:[o.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-destructive/10 text-destructive",children:o.jsx(K,{className:"h-4 w-4"})}),o.jsx("span",{className:"text-sm font-medium text-muted-foreground",children:"403"})]}),o.jsxs("div",{className:"space-y-2",children:[o.jsx("h1",{className:"text-2xl font-bold tracking-tight text-foreground",children:"Forbidden"}),o.jsx("p",{className:"text-base text-muted-foreground",children:"You don’t have permission to access this page. If you believe this is an error, check your roles in Access Context."})]}),o.jsxs("div",{className:"flex items-center gap-3 pt-2",children:[o.jsx("button",{type:"button",className:"inline-flex h-9 items-center justify-center rounded-full bg-primary px-6 text-sm font-medium text-primary-foreground shadow transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",onClick:()=>e("/",{replace:!0}),children:"Go Home"}),o.jsx("button",{type:"button",className:"inline-flex h-9 items-center justify-center rounded-full border border-input bg-background px-6 text-sm font-medium shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",onClick:()=>e(-1),children:"Go Back"})]})]})})})}typeof window<"u"&&(window.$fetch=M,window.usePages=()=>d||[],window.useAccess=y,window.usePageMeta=()=>{const e=d||[],t=te(window.location?.pathname||"/","/apps/visual-agent/"),n=R(e,t);if(!n)return;const{children:s,component:r,...i}=n;return i});function ce({DefaultLayout:e,showTop:t,mode:n}){const s=A(),{set:r}=H();return Z({navigate:s,routes:d,setTheme:r}),e?o.jsx(e,{}):o.jsx(E,{children:o.jsxs(m,{element:o.jsx(_,{showTop:t,mode:n}),children:[o.jsx(m,{path:"403",element:o.jsx(C,{})}),p(d||[])]})})}function ue(){const t=c.isApp(),{roles:n,isReady:s}=y();if(!s)return null;if(t){const i=typeof window<"u"&&/\.mspbots\.ai$/.test(window.location.hostname)?"double-column":"fullscreen",a=!1,l=i==="fullscreen"?[]:s?g(d||[],n):[];return o.jsx(x,{menus:l,mode:i,collapsible:void 0,collapsed:void 0,name:"MSPBots App",title:"Development Environment (DEV) — Data may be test or unstable",toolbar:{settingsDisabled:!0,languageDisabled:!0,fullscreenDisabled:!0,notificationsDisabled:!0,disabledTooltip:"Development Environment (DEV) — Data may be test or unstable"},showTop:a,themeRoot:()=>window.$wujie?.shadowRoot?.host,children:o.jsx(ce,{DefaultLayout:null,showTop:a,mode:i})})}return o.jsx(x,{menus:s?g(d||[],n):[],mode:"vertical",collapsible:!0,collapsed:!1,name:"MSPBots App",title:"Development Environment (DEV) — Data may be test or unstable",toolbar:{settingsDisabled:!0,languageDisabled:!0,fullscreenDisabled:!0,notificationsDisabled:!0,disabledTooltip:"Development Environment (DEV) — Data may be test or unstable"},showTop:!0,children:o.jsx(E,{children:o.jsxs(m,{element:o.jsx(_,{}),children:[o.jsx(m,{path:"403",element:o.jsx(C,{})}),p(d||[])]})})})}function p(e){const t=[];return e.forEach(n=>{const s=n.children&&n.children.length>0,r=!!n.component,i=!!n.path;if(!i&&s){t.push(...p(n.children));return}if(!i)return;const a=n.path==="/"?void 0:ee(n.path);if(s){const l=ne(a)||"*";t.push(o.jsx(m,{path:l,index:n.path==="/"&&r,element:o.jsx(j,{node:n,children:r?b.createElement(n.component):o.jsx(U,{})}),children:p(n.children)},n.path));return}r&&t.push(o.jsx(m,{path:a,index:n.path==="/",element:o.jsx(j,{node:n,children:b.createElement(n.component)})},n.path))}),t}if(typeof document<"u"){const e=()=>{const t=c.isApp(),n=c.isStandalone(),s=t||!n;let r=s?document.body:document.getElementById("root");if(!r&&n&&document.body&&(r=document.createElement("div"),r.id="root",document.body.appendChild(r)),!r)return;if(s&&r.classList.add("overflow-auto"),!T()&&u?.enabled&&u.loginPath&&h(u.loginPath)){w(u.loginPath);return}B.createRoot(r).render(o.jsx(f.StrictMode,{children:o.jsx($,{basename:"/apps/visual-agent/",children:o.jsx(ae,{children:o.jsx(ue,{})})})}))};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e()}
