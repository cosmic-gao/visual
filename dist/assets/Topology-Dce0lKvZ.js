import{j as e,I as oe,r as u,J as K,Q as F,V as de,W as pe,Y as ne,Z as Q,c as se,_ as z,a0 as Y,a1 as xe,a2 as te,X as le,a3 as ie,a4 as ge,a5 as W,a6 as be,R as fe,a7 as Ne,a8 as re,a9 as Z,aa as ve,ab as je,ac as ye,ad as we,ae as Se,af as Te,ag as Ee,ah as Ce,ai as _e,aj as ke,ak as Ue,al as Ae}from"./vendor-react-DhQkf-0u.js";import{P as $,S as Ie}from"./vendor-libs-BVVzLCuo.js";function Le(s,l){if(!s||!l)throw new Error("Node type is required");return s==="TRIGGERS"&&l==="AGENT"?"#f59e0b":s==="AGENT"&&l==="TOOLBOX"?"#3b82f6":s==="AGENT"&&l==="SKILLS"?"#22c55e":s==="AGENT"&&l==="SUB-AGENTS"?"#a855f7":"#94a3b8"}const Ge="font-sans bg-white rounded-xl border border-slate-200 shadow-[0_1px_2px_rgba(15,23,42,0.06)] w-[360px] overflow-hidden transition-shadow duration-200 hover:shadow-[0_6px_18px_rgba(15,23,42,0.10)]",Re="ring-2 ring-blue-500 ring-offset-2 ring-offset-white shadow-[0_10px_28px_rgba(37,99,235,0.18)]",X="text-[11px] font-semibold tracking-wider text-slate-600 uppercase",H="inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-[11px] font-medium text-slate-700 shadow-sm hover:bg-slate-50 active:bg-slate-100",D="inline-flex items-center justify-center rounded-md p-1.5 text-slate-500 hover:bg-slate-100 hover:text-slate-700 active:bg-slate-200",me="rounded-full border border-violet-200 bg-violet-50 px-2 py-0.5 text-[11px] font-medium text-violet-700",Oe="rounded-full border border-amber-200 bg-amber-50 px-2 py-0.5 text-[11px] font-medium text-amber-700";function J({id:s,type:l,data:t,selected:a=!1,customSlots:r,children:n}){const d=l==="AGENT"||l==="TRIGGERS"?$.Top:$.Left,x=l==="TRIGGERS"?$.Bottom:l==="AGENT"?$.Right:void 0;return e.jsxs("div",{className:`${Ge} ${a?Re:""}`,children:[e.jsx(oe,{type:"target",position:d,className:"w-2.5 h-2.5 !bg-slate-600 !border-2 !border-white"}),e.jsx("div",{className:"relative",children:n}),x?e.jsx(oe,{type:"source",position:x,className:"w-2.5 h-2.5 !bg-slate-600 !border-2 !border-white"}):null]})}function Be(s,l,t){return l?.[s]?l[s]:t}function $e(s,l){return s?s(l):null}function G({slotName:s,customSlots:l,defaultSlot:t,slotProps:a}){const r=Be(s,l,t);return e.jsx(e.Fragment,{children:$e(r,a)})}function Pe(s){const l=s.map(a=>({name:a.name,display_name:a.display_name||a.name,mcp_server_name:a.mcp_server_name,mcp_server_url:_(a.mcp_server_url)})),t={};for(const a of l){if(!a.name)throw new Error("tool.name is required");if(!a.mcp_server_url)throw new Error("tool.mcp_server_url is required");const r=`${a.mcp_server_url}::${a.name}::${a.mcp_server_name}`;t[r]=!0}return{tools:l,interrupt_config:t}}function _(s){return s?s.endsWith("/")?s.slice(0,-1):s:""}function M(s){if(!s.mcp_server_url)throw new Error("tool.mcp_server_url is required");if(!s.name)throw new Error("tool.name is required");return`${_(s.mcp_server_url)}::${s.name}`}function Me(s){return new Promise(l=>setTimeout(l,s))}async function De(s){const l=_(s.url);if(await Me(300),l.includes("tools.langchain.com"))throw new Error("tools/list 不存在（404）");const t={mcp_server_name:s.name,mcp_server_url:l};return[{...t,name:"read_url_content",display_name:"read_url_content",description:"Read the content of a URL and return text.",input_schema:{type:"object",properties:{url:{type:"string",description:"Target URL"}},required:["url"]}},{...t,name:"extract_images_from_url",display_name:"extract_images_from_url",description:"Extract image URLs from a webpage URL.",input_schema:{type:"object",properties:{url:{type:"string",description:"Target URL"}},required:["url"]}},{...t,name:"search_web",display_name:"search_web",description:"Search the web with a query string.",input_schema:{type:"object",properties:{query:{type:"string",description:"Search query"}},required:["query"]}}]}function ze(s){const[l,t]=u.useState(()=>s??[]),[a,r]=u.useState({}),[n,d]=u.useState({}),[x,j]=u.useState({}),[b,h]=u.useState(()=>new Set),[k,y]=u.useState(()=>{const N=(s??[])[0]?.url;return N?_(N):null}),[g,w]=u.useState([]),S=u.useMemo(()=>new Set(l.map(N=>_(N.url))),[l]),A=u.useCallback(N=>{const m=_(N.url);if(S.has(m))throw new Error("MCP 服务 URL 必须唯一");t(o=>[...o,{...N,url:m}]),y(o=>o??m),w(o=>[{ts:new Date().toISOString(),level:"info",message:`已新增服务：${N.name}`,serverUrl:m},...o])},[S]),I=u.useCallback((N,m)=>{const o=_(N),i=_(m.url);if(o!==i&&S.has(i))throw new Error("MCP 服务 URL 必须唯一");t(p=>p.map(C=>_(C.url)===o?{...m,url:i}:C)),y(p=>p===o?i:p),r(p=>{if(o===i)return p;const C={...p};return C[i]=C[o]??[],delete C[o],C}),d(p=>{if(o===i)return p;const C={...p};return C[i]=C[o],delete C[o],C}),j(p=>{if(o===i)return p;const C={...p};return C[i]=C[o],delete C[o],C}),h(p=>{if(o===i)return p;const C=new Set;for(const P of p)C.add(P.startsWith(`${o}::`)?`${i}${P.slice(o.length)}`:P);return C}),w(p=>[{ts:new Date().toISOString(),level:"info",message:`已更新服务：${m.name}`,serverUrl:i},...p])},[S]),R=u.useCallback(N=>{const m=_(N);t(o=>{const i=o.filter(p=>_(p.url)!==m);return y(p=>p!==m?p:i[0]?.url?_(i[0].url):null),i}),r(o=>{const i={...o};return delete i[m],i}),d(o=>{const i={...o};return delete i[m],i}),j(o=>{const i={...o};return delete i[m],i}),h(o=>{const i=new Set(o);for(const p of o)p.startsWith(`${m}::`)&&i.delete(p);return i}),w(o=>[{ts:new Date().toISOString(),level:"info",message:"已删除服务",serverUrl:m},...o])},[]),L=u.useCallback(async N=>{const m=_(N.url);j(o=>({...o,[m]:!0})),d(o=>({...o,[m]:void 0})),w(o=>[{ts:new Date().toISOString(),level:"info",message:"正在查询 tools/list",serverUrl:m},...o]);try{const o=await De({...N,url:m});return r(i=>({...i,[m]:o})),w(i=>[{ts:new Date().toISOString(),level:"info",message:`已加载工具：${o.length}`,serverUrl:m},...i]),o}catch(o){const i=o instanceof Error?o.message:"查询失败";throw d(p=>({...p,[m]:i})),r(p=>({...p,[m]:[]})),w(p=>[{ts:new Date().toISOString(),level:"error",message:`tools/list 查询失败：${i}`,serverUrl:m},...p]),o}finally{j(o=>({...o,[m]:!1}))}},[]),O=u.useCallback(N=>{const m=M(N);h(o=>{const i=new Set(o);return i.has(m)?i.delete(m):i.add(m),i})},[]),E=u.useCallback(()=>{h(new Set)},[]),v=u.useMemo(()=>{const N=[];for(const m of l){const o=_(m.url),i=a[o]??[];for(const p of i)b.has(M(p))&&N.push(p)}return N},[l,b,a]);return{servers:l,toolsByUrl:a,toolErrorByUrl:n,toolLoadingByUrl:x,activeUrl:k,logs:g,selectedKeys:b,selectedTools:v,setActiveUrl:y,addServer:A,updateServer:I,removeServer:R,fetchTools:L,toggleTool:O,clearSelection:E}}function Ke({open:s,onOpenChange:l,state:t}){const[a,r]=u.useState("connection"),n=u.useMemo(()=>{if(!t.activeUrl)return null;const c=_(t.activeUrl);return t.servers.find(T=>_(T.url)===c)??null},[t.activeUrl,t.servers]),[d,x]=u.useState(""),[j,b]=u.useState(""),[h,k]=u.useState("http"),[y,g]=u.useState(null),w=t.activeUrl?_(t.activeUrl):"",S=w?t.toolsByUrl[w]??[]:[],A=w?t.toolLoadingByUrl[w]:!1,I=w?t.toolErrorByUrl[w]:void 0,R=t.logs;if(!s)return null;const L=()=>{r("connection"),x(""),b(""),g(null),l(!1)},O=c=>{const T=_(c.url);t.setActiveUrl(T),x(c.name),b(c.url),g(null)},E=()=>{t.setActiveUrl(null),x(""),b(""),g(null)},v=async()=>{g(null);const c={name:d.trim(),url:j.trim()};if(!c.name){g("服务名称不能为空");return}if(!c.url){g("服务 URL 不能为空");return}try{n?t.updateServer(n.url,c):t.addServer(c),a!=="connection"&&r("connection")}catch(T){const U=T instanceof Error?T.message:"保存失败";g(U)}},N=()=>{n&&(t.removeServer(n.url),x(""),b(""),r("connection"))},m=async()=>{if(g(null),!n){g("请先选择服务");return}try{await t.fetchTools(n),r("tools")}catch(c){const T=c instanceof Error?c.message:"查询失败";g(T)}},o=c=>`inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium ${a===c?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-100"}`,i=e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[320px_1fr]",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Servers"}),e.jsxs("button",{className:"inline-flex items-center gap-1 rounded-full border border-slate-200 bg-white px-2.5 py-1 text-xs font-medium text-slate-700 shadow-sm hover:bg-slate-50",onClick:E,children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Add"]})]}),e.jsx("div",{className:"max-h-[520px] overflow-auto p-2",children:t.servers.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-slate-400",children:"暂无服务"}):e.jsx("div",{className:"space-y-2",children:t.servers.map(c=>{const T=_(c.url),U=T===w,q=(t.toolsByUrl[T]??[]).length,V=t.toolLoadingByUrl[T],ae=t.toolErrorByUrl[T];return e.jsx("button",{className:`w-full rounded-xl border px-3 py-3 text-left transition-colors ${U?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white hover:bg-slate-50"}`,onClick:()=>O(c),children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold",children:c.name}),e.jsx("div",{className:`truncate text-xs ${U?"text-slate-200":"text-slate-500"}`,children:T}),e.jsx("div",{className:`mt-2 text-xs ${U?"text-slate-200":"text-slate-500"}`,children:V?"Loading…":ae?"Error":`${q} tools`})]}),V?e.jsx(F,{className:`h-4 w-4 ${U?"text-slate-200":"text-slate-400"} animate-spin`}):ae?e.jsx(de,{className:`h-4 w-4 ${U?"text-slate-200":"text-rose-500"}`}):e.jsx(pe,{className:`h-4 w-4 ${U?"text-slate-200":"text-emerald-500"}`})]})},T)})})})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"border-b border-slate-200 px-4 py-3",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Server connection"}),e.jsx("div",{className:"mt-1 text-xs text-slate-500",children:"参考 MCP Inspector：配置连接并查看 Tools/Resources/Prompts"})]}),e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-600",children:"Transport"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2",children:[e.jsx(ne,{className:"h-4 w-4 text-slate-400"}),e.jsx("select",{value:h,onChange:c=>k(c.target.value),className:"w-full bg-transparent text-sm text-slate-800 outline-none",children:e.jsx("option",{value:"http",children:"HTTP"})})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-600",children:"Server name"}),e.jsx("input",{value:d,onChange:c=>x(c.target.value),className:"mt-1 w-full rounded-lg border border-slate-200 px-3 py-2 text-sm text-slate-800 outline-none focus:border-blue-400",placeholder:"Agent Builder"})]})]}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-slate-600",children:"Server URL"}),e.jsxs("div",{className:"mt-1 flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2",children:[e.jsx(Q,{className:"h-4 w-4 text-slate-400"}),e.jsx("input",{value:j,onChange:c=>b(c.target.value),className:"w-full bg-transparent text-sm text-slate-800 outline-none",placeholder:"https://example.com"})]}),e.jsx("div",{className:"mt-1 text-xs text-slate-400",children:"URL 必须唯一；当前阶段 tools/list 使用假数据模拟"})]}),y?e.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700",children:y}):null,I?e.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700",children:I}):null,e.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-2 pt-2",children:[n?e.jsx("button",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",onClick:N,children:"Delete"}):null,e.jsx("button",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",onClick:L,children:"Close"}),e.jsx("button",{className:"rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800",onClick:v,children:"Save"}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg bg-blue-600 px-3 py-2 text-sm font-medium text-white hover:bg-blue-500",onClick:m,children:[A?e.jsx(F,{className:"h-4 w-4 animate-spin"}):e.jsx(se,{className:"h-4 w-4"}),"Fetch tools"]})]})]})]})]}),p=e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[320px_1fr]",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Servers"}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>r("connection"),children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Manage"]})]}),e.jsx("div",{className:"max-h-[520px] overflow-auto p-2",children:t.servers.map(c=>{const T=_(c.url),U=T===w;return e.jsxs("button",{className:`w-full rounded-xl border px-3 py-3 text-left transition-colors ${U?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white hover:bg-slate-50"}`,onClick:()=>O(c),children:[e.jsx("div",{className:"truncate text-sm font-semibold",children:c.name}),e.jsx("div",{className:`truncate text-xs ${U?"text-slate-200":"text-slate-500"}`,children:T})]},T)})})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-slate-500"}),e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Tools"})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:m,children:[A?e.jsx(F,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(se,{className:"h-3.5 w-3.5"}),"Refresh"]})]}),e.jsx("div",{className:"p-4",children:n?I?e.jsx("div",{className:"rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700",children:I}):S.length===0?e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500",children:"暂无工具（请点击 Refresh）"}):e.jsx("div",{className:"space-y-2",children:S.map(c=>e.jsx("div",{className:"rounded-lg border border-slate-200 px-3 py-2",children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-medium text-slate-800",children:c.display_name||c.name}),e.jsx("div",{className:"truncate text-xs text-slate-500",children:c.name})]}),e.jsx("div",{className:"text-xs text-slate-400",children:c.mcp_server_name})]})},`${c.mcp_server_url}::${c.name}`))}):e.jsx("div",{className:"rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500",children:"请先选择服务"})})]})]}),C=(c,T)=>e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-900",children:[T,c]}),e.jsx("div",{className:"mt-2 text-sm text-slate-500",children:"当前阶段仅实现 Tools（假数据）；Resources/Prompts 后续可接入真实 MCP。"})]}),P=e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 px-4 py-3",children:[e.jsx(Y,{className:"h-4 w-4 text-slate-500"}),e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Notifications"})]}),e.jsx("div",{className:"max-h-[560px] overflow-auto p-3",children:R.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-slate-400",children:"暂无日志"}):e.jsx("div",{className:"space-y-2",children:R.map((c,T)=>e.jsxs("div",{className:`rounded-lg border px-3 py-2 text-sm ${c.level==="error"?"border-rose-200 bg-rose-50 text-rose-700":"border-slate-200 bg-white text-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"truncate font-medium",children:c.message}),e.jsx("div",{className:"shrink-0 text-xs text-slate-400",children:new Date(c.ts).toLocaleTimeString()})]}),c.serverUrl?e.jsx("div",{className:"mt-1 truncate text-xs text-slate-400",children:c.serverUrl}):null]},`${c.ts}-${T}`))})})]}),f=e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:L}),e.jsxs("div",{className:"absolute left-1/2 top-1/2 w-[1040px] max-w-[calc(100vw-32px)] -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-slate-200 bg-white shadow-2xl",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-5 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-slate-900 text-white",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"MCP Inspector（Mock）"}),e.jsx("div",{className:"mt-0.5 text-xs text-slate-500",children:"Server connection / Tools / Resources / Prompts / Notifications"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:o("connection"),onClick:()=>r("connection"),children:[e.jsx(ne,{className:"h-4 w-4"}),"Connection"]}),e.jsxs("button",{className:o("tools"),onClick:()=>r("tools"),children:[e.jsx(z,{className:"h-4 w-4"}),"Tools"]}),e.jsxs("button",{className:o("resources"),onClick:()=>r("resources"),children:[e.jsx(te,{className:"h-4 w-4"}),"Resources"]}),e.jsxs("button",{className:o("prompts"),onClick:()=>r("prompts"),children:[e.jsx(Q,{className:"h-4 w-4"}),"Prompts"]}),e.jsxs("button",{className:o("notifications"),onClick:()=>r("notifications"),children:[e.jsx(Y,{className:"h-4 w-4"}),"Notifications"]}),e.jsx("button",{className:"ml-1 rounded-lg p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-700",onClick:L,title:"Close",children:e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-5",children:[a==="connection"?i:null,a==="tools"?p:null,a==="resources"?C("Resources",e.jsx(te,{className:"h-4 w-4 text-slate-500"})):null,a==="prompts"?C("Prompts",e.jsx(Q,{className:"h-4 w-4 text-slate-500"})):null,a==="notifications"?P:null]})]})]});return typeof document>"u"?f:xe.createPortal(f,document.body)}function Xe(s,l){const t=JSON.stringify(l,null,2),a=new Blob([t],{type:"application/json;charset=utf-8"}),r=URL.createObjectURL(a),n=document.createElement("a");n.href=r,n.download=s,n.click(),URL.revokeObjectURL(r)}function qe({open:s,onOpenChange:l,state:t,onAdd:a}){const[r,n]=u.useState("tools"),[d,x]=u.useState(null),[j,b]=u.useState(""),[h,k]=u.useState(null),y=u.useMemo(()=>{try{return Pe(t.selectedTools)}catch{return null}},[t.selectedTools]),g=t.activeUrl?_(t.activeUrl):"",w=u.useMemo(()=>g?t.servers.find(f=>_(f.url)===g)??null:null,[g,t.servers]),S=g?t.toolsByUrl[g]??[]:[],A=g?t.toolLoadingByUrl[g]:!1,I=g?t.toolErrorByUrl[g]:void 0,R=()=>{x(null),n("tools"),l(!1)},L=f=>`inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm font-medium ${r===f?"bg-slate-900 text-white":"text-slate-700 hover:bg-slate-100"}`,O=async()=>{if(!y){x("请选择工具");return}try{await navigator.clipboard.writeText(JSON.stringify(y,null,2)),x("已复制")}catch{x("复制失败")}},E=async(f,c)=>{try{await navigator.clipboard.writeText(f),x(c)}catch{x("复制失败")}},v=()=>{if(!y){x("请选择工具");return}Xe("mcp-config.json",y),x("已下载")},N=()=>{if(!y){x("请选择工具");return}a(t.selectedTools,y),x("已添加到 Toolbox")},m=async()=>{if(!w){x("请先选择服务");return}try{await t.fetchTools(w)}catch{n("notifications")}},o=u.useMemo(()=>{const f=j.trim().toLowerCase();return f?S.filter(c=>{const T=(c.display_name||"").toLowerCase(),U=(c.name||"").toLowerCase();return T.includes(f)||U.includes(f)}):S},[S,j]),i=u.useMemo(()=>h?S.find(f=>M(f)===h)??null:null,[S,h]);u.useEffect(()=>{if(!S.length){k(null);return}h&&S.some(c=>M(c)===h)||k(M(S[0]))},[S,h]);const p=u.useMemo(()=>{if(!i?.input_schema)return null;try{return JSON.stringify(i.input_schema,null,2)}catch{return null}},[i]),C=u.useMemo(()=>{if(!i)return null;const f={name:i.name,display_name:i.display_name||i.name,description:i.description,mcp_server_name:i.mcp_server_name,mcp_server_url:i.mcp_server_url,input_schema:i.input_schema};try{return JSON.stringify(f,null,2)}catch{return null}},[i]);if(!s)return null;const P=e.jsxs("div",{className:"fixed inset-0 z-50",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40",onClick:R}),e.jsxs("div",{className:"absolute left-1/2 top-1/2 w-[1120px] max-w-[calc(100vw-32px)] -translate-x-1/2 -translate-y-1/2 rounded-2xl border border-slate-200 bg-white shadow-2xl",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-5 py-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-xl bg-slate-900 text-white",children:e.jsx(z,{className:"h-4 w-4"})}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold text-slate-900",children:"Tools"}),e.jsx("div",{className:"mt-0.5 text-xs text-slate-500",children:"参考 MCP Inspector：选择工具并导出配置"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:L("tools"),onClick:()=>n("tools"),children:[e.jsx(z,{className:"h-4 w-4"}),"Tools"]}),e.jsxs("button",{className:L("export"),onClick:()=>n("export"),children:[e.jsx(ie,{className:"h-4 w-4"}),"Export"]}),e.jsxs("button",{className:L("notifications"),onClick:()=>n("notifications"),children:[e.jsx(Y,{className:"h-4 w-4"}),"Notifications"]}),e.jsx("button",{className:"ml-1 rounded-lg p-2 text-slate-500 hover:bg-slate-100 hover:text-slate-700",onClick:R,title:"Close",children:e.jsx(le,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"p-5",children:[r==="tools"?e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[280px_1fr]",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsx("div",{className:"border-b border-slate-200 px-4 py-3",children:e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Servers"})}),e.jsx("div",{className:"max-h-[520px] overflow-auto p-2",children:t.servers.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-slate-400",children:"请先点击 MCP 配置服务"}):e.jsx("div",{className:"space-y-2",children:t.servers.map(f=>{const c=_(f.url),T=c===g,U=(t.toolsByUrl[c]??[]).length,q=t.toolLoadingByUrl[c],V=t.toolErrorByUrl[c];return e.jsxs("button",{className:`w-full rounded-xl border px-3 py-3 text-left transition-colors ${T?"border-slate-900 bg-slate-900 text-white":"border-slate-200 bg-white hover:bg-slate-50"}`,onClick:()=>t.setActiveUrl(c),children:[e.jsx("div",{className:"truncate text-sm font-semibold",children:f.name}),e.jsx("div",{className:`truncate text-xs ${T?"text-slate-200":"text-slate-500"}`,children:c}),e.jsx("div",{className:`mt-2 text-xs ${T?"text-slate-200":"text-slate-500"}`,children:q?"Loading…":V?"Error":`${U} tools`})]},c)})})})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"h-4 w-4 text-slate-500"}),e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Tools"})]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:m,children:[A?e.jsx(F,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(se,{className:"h-3.5 w-3.5"}),"Refresh"]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 p-4 lg:grid-cols-[1fr_360px]",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-lg border border-slate-200 px-3 py-2",children:[e.jsx(ge,{className:"h-4 w-4 text-slate-400"}),e.jsx("input",{value:j,onChange:f=>b(f.target.value),className:"w-full bg-transparent text-sm text-slate-800 outline-none",placeholder:"Search tools…"})]}),w?I?e.jsx("div",{className:"mt-3 rounded-lg border border-rose-200 bg-rose-50 px-3 py-2 text-sm text-rose-700",children:I}):S.length===0?e.jsx("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500",children:"暂无工具（请点击 Refresh）"}):e.jsx("div",{className:"mt-3 space-y-2 max-h-[430px] overflow-auto pr-1",children:o.map(f=>{const c=M(f),T=t.selectedKeys.has(c),U=c===h;return e.jsxs("div",{className:`flex items-center justify-between rounded-lg border px-3 py-2 transition-colors ${U?"border-slate-900 bg-slate-50":"border-slate-200 hover:bg-slate-50"}`,onClick:()=>k(c),children:[e.jsxs("button",{type:"button",className:"min-w-0 flex-1 text-left",onClick:()=>k(c),children:[e.jsx("div",{className:"truncate text-sm font-medium text-slate-800",children:f.display_name||f.name}),e.jsx("div",{className:"truncate text-xs text-slate-500",children:f.name})]}),e.jsx("input",{type:"checkbox",checked:T,onChange:()=>t.toggleTool(f),onClick:q=>q.stopPropagation(),className:"h-4 w-4 accent-slate-900"})]},c)})}):e.jsx("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-500",children:"请选择服务"})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Tool details"}),i?e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-2.5 py-1 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>{C&&E(C,"详情已复制")},children:[e.jsx(W,{className:"h-3.5 w-3.5"}),"Copy"]}):null]}),i?e.jsxs("div",{className:"mt-3 space-y-2 text-sm max-h-[520px] overflow-auto pr-1",children:[e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Display name"}),e.jsx("div",{className:"truncate font-medium text-slate-800",children:i.display_name||i.name})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Name"}),e.jsx("div",{className:"truncate font-medium text-slate-800",children:i.name})]}),i.description?e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Description"}),e.jsx("div",{className:"text-sm text-slate-700 whitespace-pre-wrap",children:i.description})]}):null,e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Server"}),e.jsx("div",{className:"truncate font-medium text-slate-800",children:i.mcp_server_name}),e.jsx("div",{className:"truncate text-xs text-slate-500",children:i.mcp_server_url})]}),e.jsxs("div",{className:"rounded-lg border border-slate-200 bg-white px-3 py-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"text-xs text-slate-500",children:"Input schema"}),p?e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-2.5 py-1 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:()=>E(p,"Schema 已复制"),children:[e.jsx(W,{className:"h-3.5 w-3.5"}),"Copy"]}):null]}),e.jsx("pre",{className:"mt-2 max-h-[220px] overflow-auto rounded-lg border border-slate-200 bg-slate-50 p-2 text-xs leading-5 text-slate-700",children:p??"{ }"})]})]}):e.jsx("div",{className:"mt-2 text-sm text-slate-500",children:"选择一个工具查看详情"})]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t border-slate-200 px-4 py-3",children:[e.jsxs("div",{className:"text-sm font-medium text-slate-800",children:["已选工具：",t.selectedTools.length]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{type:"button",className:"rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",onClick:()=>n("export"),children:"Next: Export"}),e.jsxs("button",{type:"button",className:"inline-flex items-center gap-2 rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800 disabled:opacity-50 disabled:cursor-not-allowed",onClick:N,disabled:!y,children:[e.jsx(be,{className:"h-4 w-4"}),"Add to Toolbox"]})]})]})]})]}):null,r==="export"?e.jsxs("div",{className:"grid grid-cols-1 gap-4 lg:grid-cols-[1fr_360px]",children:[e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center justify-between border-b border-slate-200 px-4 py-3",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"MCP JSON"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:O,children:[e.jsx(W,{className:"h-3.5 w-3.5"}),"Copy"]}),e.jsxs("button",{className:"inline-flex items-center gap-2 rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-medium text-slate-700 hover:bg-slate-50",onClick:v,children:[e.jsx(ie,{className:"h-3.5 w-3.5"}),"Download"]})]})]}),e.jsx("div",{className:"p-4",children:e.jsx("div",{className:"rounded-xl border border-slate-200 bg-slate-50 p-3",children:e.jsx("pre",{className:"max-h-[520px] overflow-auto text-xs leading-5 text-slate-700",children:y?JSON.stringify(y,null,2):"请选择工具以生成 JSON"})})})]}),e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white p-4",children:[e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Actions"}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx("button",{className:"w-full rounded-lg bg-slate-900 px-3 py-2 text-sm font-medium text-white hover:bg-slate-800",onClick:N,children:"Add to Toolbox"}),e.jsx("button",{className:"w-full rounded-lg border border-slate-200 bg-white px-3 py-2 text-sm font-medium text-slate-700 hover:bg-slate-50",onClick:()=>n("tools"),children:"Back to Tools"})]}),d?e.jsx("div",{className:"mt-3 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-700",children:d}):null,y?null:e.jsx("div",{className:"mt-3 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-sm text-amber-800",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),"需要至少选择一个工具"]})})]})]}):null,r==="notifications"?e.jsxs("div",{className:"rounded-xl border border-slate-200 bg-white",children:[e.jsxs("div",{className:"flex items-center gap-2 border-b border-slate-200 px-4 py-3",children:[e.jsx(Y,{className:"h-4 w-4 text-slate-500"}),e.jsx("div",{className:"text-xs font-semibold text-slate-600",children:"Notifications"})]}),e.jsx("div",{className:"max-h-[560px] overflow-auto p-3",children:t.logs.length===0?e.jsx("div",{className:"p-6 text-center text-sm text-slate-400",children:"暂无日志"}):e.jsx("div",{className:"space-y-2",children:t.logs.map((f,c)=>e.jsxs("div",{className:`rounded-lg border px-3 py-2 text-sm ${f.level==="error"?"border-rose-200 bg-rose-50 text-rose-700":"border-slate-200 bg-white text-slate-700"}`,children:[e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("div",{className:"truncate font-medium",children:f.message}),e.jsx("div",{className:"shrink-0 text-xs text-slate-400",children:new Date(f.ts).toLocaleTimeString()})]}),f.serverUrl?e.jsx("div",{className:"mt-1 truncate text-xs text-slate-400",children:f.serverUrl}):null]},`${f.ts}-${c}`))})})]}):null]})]})]});return typeof document>"u"?P:xe.createPortal(P,document.body)}const ue=u.createContext(null);function He({value:s,children:l}){return fe.createElement(ue.Provider,{value:s},l)}function Je(){const s=u.useContext(ue);if(!s)throw new Error("useTopology must be used within TopologyProvider");return s}const Ve=({data:s})=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200",children:[e.jsx("span",{className:X,children:s.label||"TRIGGERS"}),e.jsxs("button",{className:H,children:[e.jsx(K,{className:"w-3.5 h-3.5"}),"Add"]})]}),Fe=({data:s})=>e.jsxs("div",{className:"group flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-slate-50",children:[e.jsx(we,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"flex-1 text-sm text-slate-700",children:s.schedule}),e.jsx("button",{className:`opacity-0 group-hover:opacity-100 ${D}`,children:e.jsx(Z,{className:"w-4 h-4"})})]}),We=()=>e.jsx("div",{className:"p-5 text-center text-sm text-slate-400",children:"No triggers configured"}),Ye=({data:s})=>e.jsxs("div",{className:"px-4 py-3 border-b border-slate-200",children:[e.jsx("span",{className:X,children:s.label||"AGENT"}),e.jsx("h3",{className:"mt-2 text-[15px] font-semibold text-slate-900",children:s.title}),e.jsx("p",{className:"mt-1 text-sm text-slate-600",children:s.description})]}),Ze=({data:s})=>e.jsxs("div",{className:"px-4 py-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:X,children:"Instructions"}),e.jsxs("button",{className:H,children:[e.jsx(re,{className:"w-3.5 h-3.5"}),"Edit"]})]}),e.jsx("div",{className:"mt-3 max-h-[190px] overflow-auto pr-2 text-sm leading-6 text-slate-700 whitespace-pre-wrap",children:s.instructions||"No instructions provided"})]}),Qe=({data:s,nodeId:l})=>e.jsx(es,{data:s,nodeId:l});function es({data:s,nodeId:l}){const{updateNodeData:t}=Je(),a=u.useMemo(()=>s.mcpEnabled?[{name:"Agent Builder",url:"https://example.com"}]:[],[s.mcpEnabled]),r=ze(a),[n,d]=u.useState(!1),[x,j]=u.useState(!1),b=h=>{t(l,k=>{const y=k?.tools??[],g=new Set(y.map(S=>String(S.id))),w=[...y];for(const S of h){const A=M(S);g.has(A)||(w.push({id:A,name:S.display_name||S.name,source:S.mcp_server_name,status:"active"}),g.add(A))}return{...k,tools:w}}),r.clearSelection(),j(!1)};return e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200",children:[e.jsx("span",{className:X,children:s.label||"TOOLBOX"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("button",{type:"button",className:H,onClick:h=>{h.preventDefault(),h.stopPropagation(),j(!0)},children:[e.jsx(K,{className:"w-3.5 h-3.5"}),"Add"]}),s.mcpEnabled&&e.jsx("button",{type:"button",className:`${me} !border-slate-200 !bg-white !text-slate-700`,onClick:h=>{h.preventDefault(),h.stopPropagation(),d(!0)},children:"MCP"})]}),e.jsx(Ke,{open:n,onOpenChange:d,state:r}),e.jsx(qe,{open:x,onOpenChange:j,state:r,onAdd:h=>b(h)})]})}const ss=({data:s})=>{const l={active:"bg-green-100 text-green-700",review:"bg-purple-100 text-purple-700",draft:"bg-gray-100 text-gray-700",missing_key:"bg-amber-100 text-amber-700"},t=s.name.toLowerCase(),a=s.icon==="link"||t.includes("url")||t.includes("image")||t.includes("web")?je:t.includes("read")?te:ye,r=d=>d==="review"?me:d==="missing_key"?Oe:`text-[11px] px-2 py-0.5 rounded-full ${l[d]||l.draft}`,n=d=>d==="review"?"Review Required":d==="missing_key"?"API Key Missing":d;return e.jsxs("div",{className:"group flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-slate-50",children:[e.jsx(a,{className:"w-4 h-4 text-slate-400"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"text-sm text-slate-800 truncate",children:s.name}),s.source&&e.jsx("div",{className:"text-xs text-slate-500",children:s.source})]}),s.status&&e.jsxs("span",{className:r(s.status),children:[e.jsx("span",{children:n(s.status)}),s.status==="review"&&e.jsx("button",{className:"ml-1 inline-flex items-center text-violet-600 hover:text-violet-800",children:e.jsx(le,{className:"w-3 h-3"})})]}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{className:D,children:e.jsx(W,{className:"w-4 h-4"})}),e.jsx("button",{className:D,children:e.jsx(Z,{className:"w-4 h-4"})})]})]})},ts=()=>e.jsx("div",{className:"p-5 text-center text-sm text-slate-400",children:"No tools configured"}),ls=({data:s})=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200",children:[e.jsx("span",{className:X,children:s.label||"SUB-AGENTS"}),e.jsxs("button",{className:H,children:[e.jsx(K,{className:"w-3.5 h-3.5"}),"Add"]})]}),rs=({data:s})=>e.jsxs("div",{className:"group flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-slate-50",children:[e.jsx(ve,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"flex-1 text-sm text-slate-800",children:s.name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{className:D,children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{className:D,children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),as=()=>e.jsx("div",{className:"p-5 text-center text-sm text-slate-400",children:"No sub-agents configured"}),os=({data:s})=>e.jsxs("div",{className:"flex items-center justify-between px-4 py-3 border-b border-slate-200",children:[e.jsx("span",{className:X,children:s.label||"SKILLS"}),e.jsxs("button",{className:H,children:[e.jsx(K,{className:"w-3.5 h-3.5"}),"Add"]})]}),ns=({data:s})=>e.jsxs("div",{className:"group flex items-center gap-2 rounded-lg px-3 py-2 hover:bg-slate-50",children:[e.jsx(Ne,{className:"w-4 h-4 text-slate-400"}),e.jsx("span",{className:"flex-1 text-sm text-slate-800",children:s.name}),e.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100",children:[e.jsx("button",{className:D,children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{className:D,children:e.jsx(Z,{className:"w-4 h-4"})})]})]}),is=()=>e.jsx("div",{className:"p-5 text-center text-sm text-slate-400",children:"No skills configured"});function cs({id:s,type:l,data:t,selected:a}){const{triggers:r=[],customSlots:n}=t;return e.jsxs(J,{id:s,type:"TRIGGERS",data:t,selected:a,customSlots:n,children:[e.jsx(G,{slotName:"triggers.header",customSlots:n,defaultSlot:Ve,slotProps:{data:t,nodeId:s,nodeType:"TRIGGERS"}}),e.jsx("div",{className:"px-2 py-2 space-y-1 max-h-[220px] overflow-auto pr-1",children:r.length>0?r.map((d,x)=>e.jsx(G,{slotName:"triggers.item",customSlots:n,defaultSlot:Fe,slotProps:{data:d,nodeId:s,nodeType:"TRIGGERS",index:x}},d.id)):e.jsx(G,{slotName:"triggers.empty",customSlots:n,defaultSlot:We,slotProps:{data:t,nodeId:s,nodeType:"TRIGGERS"}})})]})}function ds({id:s,type:l,data:t,selected:a}){const{customSlots:r}=t;return e.jsxs(J,{id:s,type:"AGENT",data:t,selected:a,customSlots:r,children:[e.jsx(G,{slotName:"agent.header",customSlots:r,defaultSlot:Ye,slotProps:{data:t,nodeId:s,nodeType:"AGENT"}}),e.jsx(G,{slotName:"agent.instructions",customSlots:r,defaultSlot:Ze,slotProps:{data:t,nodeId:s,nodeType:"AGENT"}})]})}function xs({id:s,type:l,data:t,selected:a}){const{tools:r=[],customSlots:n}=t;return e.jsxs(J,{id:s,type:"TOOLBOX",data:t,selected:a,customSlots:n,children:[e.jsx(G,{slotName:"toolbox.header",customSlots:n,defaultSlot:Qe,slotProps:{data:t,nodeId:s,nodeType:"TOOLBOX"}}),e.jsx("div",{className:"px-2 py-2 space-y-1 max-h-[220px] overflow-auto pr-1",children:r.length>0?r.map((d,x)=>e.jsx(G,{slotName:"toolbox.item",customSlots:n,defaultSlot:ss,slotProps:{data:d,nodeId:s,nodeType:"TOOLBOX",index:x}},d.id)):e.jsx(G,{slotName:"toolbox.empty",customSlots:n,defaultSlot:ts,slotProps:{data:t,nodeId:s,nodeType:"TOOLBOX"}})})]})}function ms({id:s,type:l,data:t,selected:a}){const{subAgents:r=[],customSlots:n}=t;return e.jsxs(J,{id:s,type:"SUB-AGENTS",data:t,selected:a,customSlots:n,children:[e.jsx(G,{slotName:"subAgents.header",customSlots:n,defaultSlot:ls,slotProps:{data:t,nodeId:s,nodeType:"SUB-AGENTS"}}),e.jsx("div",{className:"px-2 py-2 space-y-1 max-h-[220px] overflow-auto pr-1",children:r.length>0?r.map((d,x)=>e.jsx(G,{slotName:"subAgents.item",customSlots:n,defaultSlot:rs,slotProps:{data:d,nodeId:s,nodeType:"SUB-AGENTS",index:x}},d.id)):e.jsx(G,{slotName:"subAgents.empty",customSlots:n,defaultSlot:as,slotProps:{data:t,nodeId:s,nodeType:"SUB-AGENTS"}})})]})}function us({id:s,type:l,data:t,selected:a}){const{skills:r=[],customSlots:n}=t;return e.jsxs(J,{id:s,type:"SKILLS",data:t,selected:a,customSlots:n,children:[e.jsx(G,{slotName:"skills.header",customSlots:n,defaultSlot:os,slotProps:{data:t,nodeId:s,nodeType:"SKILLS"}}),e.jsx("div",{className:"px-2 py-2 space-y-1 max-h-[220px] overflow-auto pr-1",children:r.length>0?r.map((d,x)=>e.jsx(G,{slotName:"skills.item",customSlots:n,defaultSlot:ns,slotProps:{data:d,nodeId:s,nodeType:"SKILLS",index:x}},d.id)):e.jsx(G,{slotName:"skills.empty",customSlots:n,defaultSlot:is,slotProps:{data:t,nodeId:s,nodeType:"SKILLS"}})})]})}function ee({id:s,sourceX:l,sourceY:t,targetX:a,targetY:r,sourcePosition:n,targetPosition:d,style:x={},markerEnd:j,selected:b,data:h}){const[k]=Ie({sourceX:l,sourceY:t,sourcePosition:n,targetX:a,targetY:r,targetPosition:d,curvature:.28}),y=h?.color??x?.stroke??"#94a3b8",g=b?2.25:1.75;return e.jsxs("g",{children:[e.jsx(Se,{id:s,path:k,markerEnd:j,style:{...x,strokeDasharray:"4 6",strokeLinecap:"round",strokeWidth:g,stroke:y}}),e.jsx("circle",{cx:l,cy:t,r:4,fill:y,stroke:"#ffffff",strokeWidth:2}),e.jsx("circle",{cx:a,cy:r,r:4,fill:y,stroke:"#ffffff",strokeWidth:2})]})}const hs={TRIGGERS:cs,AGENT:ds,TOOLBOX:xs,"SUB-AGENTS":ms,SKILLS:us},ps={dashed:ee,solid:ee,animated:ee},gs=280,bs=190,ce=72,fs=12,Ns={TRIGGERS:{width:360,height:180},AGENT:{width:360,height:360},TOOLBOX:{width:360,height:260},"SUB-AGENTS":{width:360,height:220},SKILLS:{width:360,height:220}};function B(s){return Ns[s.type]??{width:360,height:240}}function vs(s,l={type:"auto",direction:"vertical"}){if(l.type==="manual")return s;const t={horizontal:Math.max(l.spacing?.horizontal??gs,160),vertical:Math.max(l.spacing?.vertical??bs,120)},a=l.direction==="vertical",r=js(s),n=a?ys(r,t):ws(r,t);return he(n)}function he(s,l=ce,t){const a=l??ce,r=s.map(n=>({...n,position:{...n.position}}));for(let n=0;n<fs;n++){let d=!1;for(let x=0;x<r.length;x++)for(let j=x+1;j<r.length;j++){const b=r[x],h=r[j],k=t?.has(String(b.id))??!1,y=t?.has(String(h.id))??!1,g=B(b),w=B(h),S={x:b.position.x+g.width/2,y:b.position.y+g.height/2},A={x:h.position.x+w.width/2,y:h.position.y+w.height/2},I=A.x-S.x,R=A.y-S.y,L=Math.abs(I),O=Math.abs(R),E=g.width/2+w.width/2+a,v=g.height/2+w.height/2+a;if(L>=E||O>=v)continue;const N=E-L,m=v-O,o=y&&!k,i=o?b:h;N<m?i.position.x+=(I>=0?1:-1)*N*(o?-1:1):i.position.y+=(R>=0?1:-1)*m*(o?-1:1),d=!0}if(!d)break}return r}function js(s){const l={TRIGGERS:[],AGENT:[],TOOLBOX:[],"SUB-AGENTS":[],SKILLS:[]};return s.forEach(t=>{l[t.type]&&l[t.type].push(t)}),l}function ys(s,l){const t=[];let a=0;const r=0;if(s.TRIGGERS.length>0){const n=s.TRIGGERS[0],d=B(n);t.push({...n,position:{x:r,y:a}}),a+=d.height+l.vertical}if(s.AGENT.length>0){const n=s.AGENT[0],d=B(n);t.push({...n,position:{x:r,y:a}});const x=r+d.width+l.horizontal;let j=a;if(s.TOOLBOX.length>0){const b=s.TOOLBOX[0],h=B(b);t.push({...b,position:{x,y:j}}),j+=h.height+l.vertical}s["SUB-AGENTS"].forEach(b=>{const h=B(b);t.push({...b,position:{x,y:j}}),j+=h.height+l.vertical}),s.SKILLS.forEach(b=>{const h=B(b);t.push({...b,position:{x,y:j}}),j+=h.height+l.vertical})}return t}function ws(s,l){const t=[];let a=0;const r=0;if(s.TRIGGERS.length>0){const d=s.TRIGGERS[0],x=B(d);t.push({...d,position:{x:a,y:r}}),a+=x.width+l.horizontal}if(s.AGENT.length>0){const d=s.AGENT[0],x=B(d);t.push({...d,position:{x:a,y:r}}),a+=x.width+l.horizontal}let n=0;return["TOOLBOX","SUB-AGENTS","SKILLS"].forEach(d=>{s[d].forEach(x=>{const j=B(x);t.push({...x,position:{x:a,y:r+n}}),n+=j.height+l.vertical})}),t}function Ss(s){const l=[],t=[];(!s.nodes||s.nodes.length===0)&&l.push({type:"error",field:"nodes",message:"Configuration must contain at least one node"});const a=Es(s.nodes||[],l);return Cs(s.edges||[],a,l),_s(s.nodes||[],t),{valid:l.length===0,errors:l,warnings:t}}function Ts(s){return{...s,nodes:s.nodes.map((l,t)=>({...l,position:l.position||{x:0,y:t*200},data:{...l.data,label:l.data.label||`Node ${t+1}`}})),edges:(s.edges||[]).map((l,t)=>({...l,type:l.type||"dashed",id:l.id||`edge-${t}`})),layout:s.layout||{type:"auto",direction:"vertical",spacing:{horizontal:250,vertical:150}}}}function Es(s,l){const t=new Set;return s.forEach((a,r)=>{a.id?t.has(a.id)?l.push({type:"error",field:`nodes[${r}].id`,message:`Duplicate node id: ${a.id}`}):t.add(a.id):l.push({type:"error",field:`nodes[${r}].id`,message:"Node must have an id"}),a.type||l.push({type:"error",field:`nodes[${r}].type`,message:"Node must have a type"}),a.data||l.push({type:"error",field:`nodes[${r}].data`,message:"Node must have data"})}),t}function Cs(s,l,t){s.forEach((a,r)=>{a.id||t.push({type:"error",field:`edges[${r}].id`,message:"Edge must have an id"}),a.source?l.has(a.source)||t.push({type:"error",field:`edges[${r}].source`,message:`Edge source node "${a.source}" does not exist`}):t.push({type:"error",field:`edges[${r}].source`,message:"Edge must have a source node id"}),a.target?l.has(a.target)||t.push({type:"error",field:`edges[${r}].target`,message:`Edge target node "${a.target}" does not exist`}):t.push({type:"error",field:`edges[${r}].target`,message:"Edge must have a target node id"})})}function _s(s,l){const t=s.filter(a=>a.type==="AGENT");t.length===0&&l.push({type:"warning",field:"nodes",message:"No AGENT node found. Topology should typically have a main AGENT node."}),t.length>1&&l.push({type:"warning",field:"nodes",message:"Multiple AGENT nodes found. Consider using SUB-AGENTS for additional agents."})}function ks({config:s,slots:l,className:t="",fitView:a=!0,interactive:r=!0,onNodeClick:n,onEdgeClick:d,onChange:x,showMiniMap:j}){const b=u.useMemo(()=>{const E=Ss(s);return E.valid||console.error("Topology configuration validation failed:",E.errors),E.warnings.length>0&&console.warn("Topology configuration warnings:",E.warnings),Ts(s)},[s]),h=u.useMemo(()=>{const E=b.nodes.map(v=>({...v,data:{...v.data,customSlots:l},targetPosition:v.type==="AGENT"||v.type==="TRIGGERS"?$.Top:$.Left,sourcePosition:v.type==="AGENT"?$.Right:v.type==="TRIGGERS"?$.Bottom:$.Right}));return b.layout?.type==="auto"?vs(E,b.layout):E},[b,l]),k=u.useMemo(()=>{const E=new Map;for(const v of h)typeof v.id=="string"&&typeof v.type=="string"&&E.set(v.id,v.type);return b.edges.map(v=>{const N=E.get(v.source),m=E.get(v.target),o=N&&m?Le(N,m):"#94a3b8";return{...v,type:v.type??"dashed",data:{...v.data??{},color:o}}})},[h,b.edges]),[y,g]=Te(h),[w,S,A]=Ee(k),I=u.useCallback(E=>{g(v=>{const N=Ce(E,v),m=new Set(E.filter(o=>o.type==="position"&&o.dragging===!1).map(o=>String(o.id)));return m.size===0?N:he(N,void 0,m)})},[g]);u.useEffect(()=>{g(h)},[h,g]),u.useEffect(()=>{S(k)},[k,S]);const R=u.useCallback((E,v)=>{n&&n(v)},[n]),L=u.useCallback((E,v)=>{d&&d(v)},[d]),O=u.useCallback(()=>{x&&x(y,w)},[y,w,x]);return u.useEffect(()=>{O()},[y,w,O]),e.jsx("div",{className:`w-full h-full bg-slate-50 bg-[radial-gradient(circle_at_1px_1px,rgba(148,163,184,0.28)_1px,transparent_0)] [background-size:24px_24px] ${t}`,children:e.jsx(He,{value:{updateNodeData:(E,v)=>{g(N=>N.map(m=>{if(String(m.id)!==String(E))return m;const o=v(m.data);return{...m,data:o}}))}},children:e.jsxs(_e,{nodes:y,edges:w,onNodesChange:r?I:void 0,onEdgesChange:r?A:void 0,onNodeClick:R,onEdgeClick:L,nodeTypes:hs,edgeTypes:ps,fitView:a,nodesDraggable:r,nodesConnectable:!1,elementsSelectable:r,snapToGrid:r,snapGrid:[12,12],minZoom:.2,maxZoom:2,defaultEdgeOptions:{type:"dashed",animated:!1},children:[e.jsx(ke,{color:"#e2e8f0",gap:16}),e.jsx(Ue,{showInteractive:!1,position:"bottom-left"}),j&&e.jsx(Ae,{nodeStrokeWidth:3,pannable:!0,zoomable:!0,className:"!bg-white/90 !border-slate-200 !rounded-lg !shadow-sm"})]})})})}const Is={label:"Topology",icon:"Home",order:1,menu:!0};function Ls(){const s={nodes:[{id:"triggers-1",type:"TRIGGERS",data:{label:"TRIGGERS",triggers:[{id:"trigger-1",schedule:"At 08:00 AM, every day"}]},position:{x:80,y:60}},{id:"agent-1",type:"AGENT",data:{label:"AGENT",title:"Daily Calendar Brief",description:"Reviews your calendar and sends you a brief",instructions:`Daily Calendar Brief

You are a personal calendar assistant that provides a helpful morning brief of the user's day....`},position:{x:80,y:300}},{id:"toolbox-1",type:"TOOLBOX",data:{label:"TOOLBOX",mcpEnabled:!0,tools:[{id:"tool-1",name:"Read ...",source:"Agent B...",status:"review"},{id:"tool-2",name:"Extract Images From URL",source:"Agent Builder",status:"active"}]},position:{x:560,y:60}},{id:"subagents-1",type:"SUB-AGENTS",data:{label:"SUB-AGENTS",subAgents:[{id:"sub-1",name:"Sub-agent 1"}]},position:{x:560,y:340}},{id:"skills-1",type:"SKILLS",data:{label:"SKILLS",skills:[{id:"skill-1",name:"new-skill"}]},position:{x:560,y:620}}],edges:[{id:"e-triggers-agent",source:"triggers-1",target:"agent-1",type:"dashed"},{id:"e-agent-toolbox",source:"agent-1",target:"toolbox-1",type:"dashed"},{id:"e-agent-subagents",source:"agent-1",target:"subagents-1",type:"dashed"},{id:"e-agent-skills",source:"agent-1",target:"skills-1",type:"dashed"}],layout:{type:"manual"}};return e.jsx("div",{className:"w-full h-screen bg-gray-50",children:e.jsx("div",{className:"w-full h-[calc(100vh-100px)]",children:e.jsx(ks,{config:s,fitView:!0,interactive:!0,onNodeClick:l=>{console.log("Node clicked:",l)}})})})}export{Ls as default,Is as meta};
